<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>OpenMUC User Guide</title>
<style>
/*
 * AsciiDoc 'volnitsky' theme for xhtml11 and html5 backends.
 * Based on css from http://volnitsky.com, which was in turn based on default
 * theme from AsciiDoc
 *
 * FIXME: The styling is still a bit rough in places.
 *
 */

/* Default font. */
body {
  font-family: Helvetica, sans-serif;
  max-width:62.5em;
  margin: auto;
}

/* Title font. */

h1, h2, h3, h4, h5, h6 {
    clear: both;
    font-family: Helvetica, serif;
    line-height: 1.3;
}

a {
    border-bottom: 1px dotted #999999;
    color: #378f03 !important;
    text-decoration: none !important;
}
a:hover {
    border-bottom: 1px solid #378f03;
    color: #378f03 !important;
    text-decoration: none !important;
}

em {
  font-style: italic;
  color: #4E4E4E;
}

strong {
  font-weight: bold;
  color: #000000;
}


div.sectionbody {
/*  margin-left: 0;*/
}

hr {
  border: 1px solid #575757;
}


pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #575757;
  font-weight: bold;
  font-size: 1.1em;
}

#footer {
  font-size: small;
  padding-top: 0.5em;
  margin-top: 4.0em;
}

#footer-text {
  float: left;
  padding-bottom: 0.5em;
}

#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}

div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}

div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #575757;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.verseblock > pre.content {
  font-family: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #575757;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: #575757;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #575757;
}
thead {
  font-weight: bold;
  color: #575757;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: #575757;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

@media print {
  #footer-badges { display: none; }
}

#toctitle {
  color: #575757;
  font-size: 1.2em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 { margin-top: 0; margin-bottom: 0; }
div.toclevel1 { margin-top: 0.3em; margin-left: 0; font-size: 1.0em; }
div.toclevel2 { margin-top: 0.25em; margin-left: 2em; font-size: 0.9em; }
div.toclevel3 { margin-left: 4em; font-size: 0.8em; }
div.toclevel4 { margin-left: 6em; font-size: 0.8em; }



.monospaced, tt, div.listingblock > div.content {
  font-family:  Consolas, "Andale Mono", "Courier New", monospace;
  color: #004400;
  background: #f4f4f4;
  max-width: 80em;
  line-height: 1.2em;
}

.paragraph p  {
  line-height: 1.5em;
  margin-top: 1em;
}

/*.paragraph p, li, dd, .content { max-width: 85em; }
.admonitionblock               { max-width: 35em; }*/

div.sectionbody div.ulist > ul > li {
  list-style-type: square;
  color: #aaa;
}
  div.sectionbody div.ulist >  ul > li > * {
    color: black;
    /*font-size: 50%;*/
  }


div.sectionbody div.ulist > ul > li div.ulist > ul > li {
  color: #ccd ;
}
  div.sectionbody div.ulist > ul > li div.ulist > ul > li > * {
    color: black ;
  }

/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #575757;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #575757;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #575757;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}



</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>OpenMUC User Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_intro">1. Intro</a></li>
<li><a href="#_quick_start">2. Quick Start</a>
<ul class="sectlevel2">
<li><a href="#_starting_the_demo">2.1. Starting the Demo</a></li>
<li><a href="#_webui_walk_through">2.2. WebUI Walk Through</a></li>
</ul>
</li>
<li><a href="#_tutorials">3. Tutorials</a>
<ul class="sectlevel2">
<li><a href="#_build_a_simple_m_bus_data_logger">3.1. Build a Simple M-Bus Data Logger</a></li>
<li><a href="#_develop_a_customised_application">3.2. Develop a Customised Application</a></li>
<li><a href="#anchor-tutorial-webui-plugin">3.3. Develop a Customised WebUI Plugin</a></li>
</ul>
</li>
<li><a href="#anchor-architecture">4. Architecture</a>
<ul class="sectlevel2">
<li><a href="#_file_structure_of_the_distribution">4.1. File Structure of the Distribution</a></li>
<li><a href="#_framework_files">4.2. Framework Files</a></li>
<li><a href="#_devices_and_channels">4.3. Devices and Channels</a></li>
<li><a href="#anchor-configuration">4.4. Configuration via channels.xml</a></li>
<li><a href="#_sampling_listening_and_logging">4.5. Sampling, Listening and Logging</a></li>
</ul>
</li>
<li><a href="#anchor-start-script">5. OpenMUC start script</a>
<ul class="sectlevel2">
<li><a href="#_auto_start_at_boot_time">5.1. Auto-start at Boot Time</a></li>
</ul>
</li>
<li><a href="#drivers">6. Drivers</a>
<ul class="sectlevel2">
<li><a href="#_install_a_driver">6.1. Install a Driver</a></li>
<li><a href="#_modbus">6.2. Modbus</a></li>
<li><a href="#_m_bus_wired">6.3. M-Bus (wired)</a></li>
<li><a href="#_m_bus_wireless">6.4. M-Bus (wireless)</a></li>
<li><a href="#_iec_60870_5_104">6.5. IEC 60870-5-104</a></li>
<li><a href="#_iec_61850">6.6. IEC 61850</a></li>
<li><a href="#_iec_62056_part_21">6.7. IEC 62056 part 21</a></li>
<li><a href="#_dlmscosem">6.8. DLMS/COSEM</a></li>
<li><a href="#_knx">6.9. KNX</a></li>
<li><a href="#_ehz">6.10. eHZ</a></li>
<li><a href="#_snmp">6.11. SNMP</a></li>
<li><a href="#_csv">6.12. CSV</a></li>
<li><a href="#_aggregator">6.13. Aggregator</a></li>
<li><a href="#_restjson">6.14. REST/JSON</a></li>
</ul>
</li>
<li><a href="#anchor-web-ui">7. The WebUI</a>
<ul class="sectlevel2">
<li><a href="#_plugins">7.1. Plugins</a></li>
<li><a href="#_context_root">7.2. Context Root</a></li>
<li><a href="#_https">7.3. HTTPS</a></li>
<li><a href="#_custom_plugins">7.4. Custom Plugins</a></li>
<li><a href="#_visualisation">7.5. Visualisation</a></li>
</ul>
</li>
<li><a href="#id_restful_web_services">8. REST Server</a>
<ul class="sectlevel2">
<li><a href="#_requirements">8.1. Requirements</a></li>
<li><a href="#_accessing_channels">8.2. Accessing channels</a></li>
</ul>
</li>
<li><a href="#id_modbus_service">9. Modbus Server</a>
<ul class="sectlevel2">
<li><a href="#_example">9.1. Example</a></li>
</ul>
</li>
<li><a href="#_authors">10. Authors</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_intro">1. Intro</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenMUC is a software framework based on Java and OSGi that simplifies
the development of customized monitoring, logging and control
systems. It can be used as a basis to flexibly implement anything from
simple data loggers to complex SCADA systems. The main goal of OpenMUC
is to shield the application developer of monitoring and control
applications from the details of the communication protocol and data
logging technologies. Third parties are encouraged to create their own
customized systems based on OpenMUC. OpenMUC is licensed under the
GPL. If you need an individual license please
<a href="https://www.openmuc.org/contact/">contact</a> us.</p>
</div>
<div class="paragraph">
<p>For a short overview of OpenMUC&#8217;s goals and features please visit our
<a href="https://www.openmuc.org/openmuc/">overview page</a>. This guide is a
detailed documentation on how OpenMUC works and how to use it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quick_start">2. Quick Start</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter will give you an idea of how OpenMUC works by showing you
how to run and adjust the demo framework which is part of the OpenMUC
distribution. OpenMUC requires Java 7 or higher, therefore make sure
it is installed on your machine.</p>
</div>
<div class="sect2">
<h3 id="_starting_the_demo">2.1. Starting the Demo</h3>
<div class="paragraph">
<p>The contains a simple demo app which demonstrates how you can access channels and
their records from an application. The app reads data from channels of
the CSV driver, calculates new values from them and writes them to
other channels. The app can be used as starting point to create your
own OpenMUC application.</p>
</div>
<div class="paragraph">
<p>First open a terminal and go to the folder named "framework".</p>
</div>
<div class="paragraph">
<p>To start OpenMUC on Linux run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc start -fg</pre>
</div>
</div>
<div class="paragraph">
<p>To start OpenMUC on Windows run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bin\openmuc.bat</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the start script see chapter <a href="#anchor-start-script">OpenMUC start script</a>.</p>
</div>
<div class="paragraph">
<p>This will start the Apache Felix OSGi framework which in turn starts
all the bundles located in the "bundle" folder. Among the bundles that
are started is the Apache Gogo shell. This shell is entered once you
run OpenMUC.</p>
</div>
<div class="paragraph">
<p>Now type "lb" to list all installed bundles.</p>
</div>
<div class="paragraph">
<p>You will see that among the active bundles are the Simple Demo App,
the OpenMUC core bundles, two data loggers (ASCII and SlotsDB) as well
as the CSV driver.</p>
</div>
<div class="paragraph">
<p>The shell can be used to start, stop, and reload bundles among other
things. You can stop and exit the OSGi framework any time by typing "ctrl+d"
or "stop 0".</p>
</div>
</div>
<div class="sect2">
<h3 id="_webui_walk_through">2.2. WebUI Walk Through</h3>
<div class="paragraph">
<p>This section leads you through the framework&#8217;s WebUI.</p>
</div>
<div class="paragraph">
<p>Open a browser (works currently best with Google Chrome) and enter the
URL "http://localhost:8888". This leads you to the login page. The
default user is <em>admin</em> and the default password is <em>admin</em> as well.</p>
</div>
<div class="paragraph">
<p>After successful login the OpenMUC Dashboard opens, which provides
various plugins for configuration and visualization. A full
description of the plugins can be found in the chapter
<a href="#anchor-web-ui">Web UI</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/webui-dashboard.png"><img src="images/webui-dashboard.png" alt="webui dashboard" width="60%"></a>
</div>
<div class="title">Figure 1. WebUI Dashboard</div>
</div>
<div class="paragraph">
<p>Let us first look at the Channel Access Tool which provides the
current value of each channel and also enables you to write
values. Click on Channel Access Tool to open this plugin. The next
page lists all available devices which are currently configured in
OpenMUC. Select the <em>home1</em> and proceed with <em>Access selected</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/webui-channelaccesstool-device-selection.png"><img src="images/webui-channelaccesstool-device-selection.png" alt="webui channelaccesstool device selection" width="60%"></a>
</div>
<div class="title">Figure 2. WebUI device selection</div>
</div>
<div class="paragraph">
<p>On the next page you will see the latest records of all channels of
home1. Each record consists of a data value, a timestamp when it was
sampled and a quality flag.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/webui-channelaccesstool-channels.png"><img src="images/webui-channelaccesstool-channels.png" alt="webui channelaccesstool channels" width="60%"></a>
</div>
<div class="title">Figure 3. WebUI channel access tool</div>
</div>
<div class="paragraph">
<p>Let&#8217;s have look at the <em>Data Plotter</em>. To get to the <em>Data Plotter</em>
click on <em>Applications</em> next to the OpenMUC logo and select <em>Data
Plotter</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/webui-dataplotter.png"><img src="images/webui-dataplotter.png" alt="webui dataplotter" width="60%"></a>
</div>
<div class="title">Figure 4. WebUI data plotter</div>
</div>
<div class="paragraph">
<p>Select the <em>Live</em> Data Plotter. To view the live data select the channels of your choice and
click <em>Plot Data</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/webui-dataplotter-live.png"><img src="images/webui-dataplotter-live.png" alt="webui dataplotter live" width="60%"></a>
</div>
<div class="title">Figure 5. WebUI live plotter</div>
</div>
<div class="paragraph">
<p>The last WebUI plugin we want to look at is a customised visualisation for our demo application. Click on <em>Applications</em> and select <em>Simple Demo Visualisation</em>. The purpose of this plugin is to show how OpenMUC channels can be accessed and used for individual visualisations. Detailed informations about the development of such a plugin can be found in the <a href="#anchor-tutorial-webui-plugin">Tutorial Develop a Customised WebUI Plugin</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/simpleDemoVisualisation.png"><img src="images/simpleDemoVisualisation.png" alt="simpleDemoVisualisation" width="60%"></a>
</div>
<div class="title">Figure 6. WebUI customised visualisation</div>
</div>
<div class="sect3">
<h4 id="_add_a_new_channel">2.2.1. Add a New Channel</h4>
<div class="paragraph">
<p>All channels currently defined get their data using the CSV driver
from the file "csv-driver/home1.csv". That file contains additional
data. So let us now add a new channel to the OpenMUC configuration
using the channel scan feature.</p>
</div>
<div class="paragraph">
<p>In the WebUI go to the Channel Configurator. Click the tab
"Devices". In the row of device "home1" click on the search/scan
icon. It shows you all the channels available in that device. Once the
scan has completed a list of available channels is shown. In this
tutorial we select the channel with address
"pv_energy_production". Click "add channels".</p>
</div>
<div class="paragraph">
<p>Now the channel overview opens where we can find our selected
channel. In the last step of the configuration we click on the edit
icon of the channel and set the parameters <em>logging interval</em> and
<em>sampling interval</em> to 5000 ms and change the unit to kWh.</p>
</div>
<div class="paragraph">
<p>You can now check that the new channel was added to the
"conf/channels.xml" file.</p>
</div>
<div class="paragraph">
<p>After submitting the channel configuration we go back to the dashboard
and open the Channel Access Tool. Here we select our home1 device and
continue with <em>access selected</em>. Now we able to see the current values
of the pv_energy_production channel.</p>
</div>
<div class="paragraph">
<p>The logged data can be found in
<em>openmuc/framework/data/ascii/&lt;currentdate&gt;_5000.dat</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorials">3. Tutorials</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_build_a_simple_m_bus_data_logger">3.1. Build a Simple M-Bus Data Logger</h3>
<div class="paragraph">
<p><strong>Objective:</strong> You will learn how to create a simple data logger which reads out a M-Bus meter via serial communication. It uses OpenMUC on-board tools so no programming is required.</p>
</div>
<div class="paragraph">
<p><strong>Preparation:</strong> If not already done, your system needs to be prepared once for serial communication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo apt-get install librxtx-java
sudo adduser $USER dialout</pre>
</div>
</div>
<div class="paragraph">
<p>Now logout from your system and login again to apply system changes.</p>
</div>
<div class="paragraph">
<p><strong>Step-by-step</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download OpenMUC and unpack it</p>
</li>
<li>
<p>Open openmuc/framework/conf/bundles.conf.gradle and comment the following lines by //</p>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework", name: "openmuc-app-simpledemo", version: openmucVersion
osgibundles group: "org.openmuc.framework", name: "openmuc-driver-csv", version: openmucVersion</pre>
</div>
</div>
</li>
<li>
<p>Add following lines to make the M-Bus driver and serial communication available</p>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework" name: "openmuc-driver-mbus", version: openmucVersion
osgibundles group: "org.openmuc", name: "jrxtx", version: "1.0.1"</pre>
</div>
</div>
</li>
<li>
<p>To apply changes navigate to openmuc/framework/bin and run</p>
<div class="listingblock">
<div class="content">
<pre>./openmuc update-bundles</pre>
</div>
</div>
</li>
<li>
<p>Start OpenMUC</p>
<div class="listingblock">
<div class="content">
<pre>./openmuc start -fg</pre>
</div>
</div>
</li>
<li>
<p>Open a browser and point it to localhost:8888 to view the WebUI of OpenMUC. Login with user <em>admin</em> and password <em>admin</em>.</p>
</li>
<li>
<p>Click on <em>Channel Configurator</em> &gt; <em>Tab Drivers</em> &gt; <em>Add new driver to configuration</em></p>
</li>
<li>
<p>Enter <em>mbus</em> as ID and click Submit</p>
</li>
<li>
<p>Now the M-Bus driver appears under <em>Channel Configurator</em> &gt; <em>Tab Drivers</em>. Click on the search icon</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorial_mbus_logger_channel_configurator.png"><img src="images/tutorial_mbus_logger_channel_configurator.png" alt="tutorial mbus logger channel configurator" width="400"></a>
</div>
<div class="title">Figure 7. WebUI data plotter</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the serial port the meter is connected to and provide the baud rate if needed (e.g. /dev/ttyS0 or /dev/ttyS0:2400). See M-Bus driver section for more information.</p>
</li>
<li>
<p>Click on <em>Scan for devices</em>. Now OpenMUC scans all M-Bus addresses, which may take a while</p>
</li>
<li>
<p>Select the desired device from the list and click <em>Add devices</em></p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorial_mbus_logger_driver_scan.png"><img src="images/tutorial_mbus_logger_driver_scan.png" alt="tutorial mbus logger driver scan" width="400"></a>
</div>
<div class="title">Figure 8. WebUI M-Bus device scan</div>
</div>
</li>
<li>
<p>Now the device is added. If you do not see the search icon next to the device, press F5 to reload the page and navigate to <em>Channel Configurator</em> &gt; <em>Tab Devices</em></p>
</li>
<li>
<p>Click on the search icon and OpenMUC automatically scans all available channels. Select the desired channels and click <em>Add channels</em></p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorial_mbus_logger_channel_scan.png"><img src="images/tutorial_mbus_logger_channel_scan.png" alt="tutorial mbus logger channel scan" width="400"></a>
</div>
<div class="title">Figure 9. WebUI M-Bus channel scan</div>
</div>
</li>
<li>
<p>Now we need to define a sampling and logging interval for the channels. Click on <em>Channel Configurator</em> &gt; <em>Tab Channels</em> and click on <em>Edit Icon</em> of the desired channel. Write <em>2000</em> in the <em>Sampling Interval</em> and <em>Logging Interval</em> field and click Submit</p>
</li>
<li>
<p>To show actual values of the channel, navigate to <em>Applications</em> &gt; <em>Channel Access Tool</em>, select your device and click <em>Access selected</em></p>
<div class="imageblock">
<div class="content">
<a class="image" href="images/tutorial_mbus_logger_channel_access_tool.png"><img src="images/tutorial_mbus_logger_channel_access_tool.png" alt="tutorial mbus logger channel access tool" width="400"></a>
</div>
<div class="title">Figure 10. WebUI channel access tool</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Tips</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>All logged data are stored in /openmuc/framework/data/ascii/</p>
</li>
<li>
<p>You can also change the configuration by editing /openmuc/framework/conf/channels.xml</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_develop_a_customised_application">3.2. Develop a Customised Application</h3>
<div class="paragraph">
<p><strong>Objective:</strong> You will learn how to develop your own OpenMUC application. This tutorial focuses on the Eclipse integration, build process and how to start your application in the felix OSGi framework.</p>
</div>
<div class="paragraph">
<p><strong>Preparation:</strong> This tutorial is based on Eclipse IDE and Gradle build tool, therefore you need Eclipse IDE and Gradle installed on your pc.</p>
</div>
<div class="paragraph">
<p><strong>Step-by-step</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and unpack the OpenMUC framework. Open a terminal and navigate to the openmuc folder</p>
</li>
<li>
<p>Create a new project based on the simple demo application. Navigate to openmuc/projects/app and copy the simpledemo folder and rename the copy to <em>ems</em> (Energy Management System).</p>
</li>
<li>
<p>Edit the build.gradle file inside your <em>ems</em> folder. Rename the project name and description and save the file.</p>
<div class="listingblock">
<div class="content">
<pre>def projectName = "EMS"
...
description "OpenMUC Energy Management System.."</pre>
</div>
</div>
</li>
<li>
<p>Navigate to app/ems/src/main/java/org/openmuc/framework/app/ and rename the folder simpledemo to ems</p>
</li>
<li>
<p>Replace the SimpleDemoApp.java inside this ems folder with EmsApp.java.</p>
<div class="listingblock">
<div class="content">
<pre>package org.openmuc.framework.app.simpledemo;

import org.openmuc.framework.data.Record;
import org.openmuc.framework.dataaccess.Channel;
import org.openmuc.framework.dataaccess.DataAccessService;
import org.openmuc.framework.dataaccess.RecordListener;
import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.Deactivate;
import org.osgi.service.component.annotations.Reference;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

@Component(service = {})
public final class EmsApp{

	private static final Logger logger = LoggerFactory.getLogger(EmsApp.class);
	private static final String APP_NAME = "OpenMUC EMS App";

	private Channel chPowerGrid;
	private RecordListener powerListener;

	@Reference
	private DataAccessService dataAccessService;

	@Activate
	private void activate() {
		logger.info("Activating {}", APP_NAME);
		powerListener = new PowerListener();
		chPowerGrid = dataAccessService.getChannel("power_grid");
		chPowerGrid.addListener(powerListener);
	}

	@Deactivate
	private void deactivate() {
		logger.info("Deactivating {}", APP_NAME);
		chPowerGrid.removeListener(powerListener);
	}
}

class PowerListener implements RecordListener{

	private static final Logger logger = LoggerFactory.getLogger(PowerListener.class);

	@Override
	public void newRecord(Record record) {
		if (record.getValue() != null) {
			logger.info("&gt;&gt;&gt; grid power: {}", record.getValue().asDouble());
		}
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>This is a light version of the simple demo application and basically adds a listener to the power_grid channel and logs the current value. This class can be used for further development of your application.</p>
</div>
</li>
<li>
<p>Now we add our project to the gradle build process. For this purpose open the openmuc/settings.gradle in an editor and append following statement to the include statement</p>
<div class="listingblock">
<div class="content">
<pre>, "openmuc-app-ems"</pre>
</div>
</div>
</li>
<li>
<p>Furthermore you need to add following line at the end of settings.gradle</p>
<div class="listingblock">
<div class="content">
<pre>project(":openmuc-app-ems").projectDir = file("projects/app/ems")</pre>
</div>
</div>
</li>
<li>
<p>Now we create the Eclipse project files by running the following command in the openmuc main directory</p>
<div class="listingblock">
<div class="content">
<pre>gradle eclipse</pre>
</div>
</div>
</li>
<li>
<p>Start your Eclipse IDE and set the GRADLE_USER_HOME classpath variable: Go to Window&gt;Preferences&gt;Java&gt;Build Path&gt;Classpath Variable. Set the variable GRADLE_USER_HOME to the path of the ~/.gradle folder in your home directory (e.g. /home/&lt;user_name&gt;/.gradle/</p>
</li>
<li>
<p>Import the Openmuc projects into Eclipse: Go to File&gt;Import&gt;General&gt;Existing Projects into Workspace, select your OpenMUC directory and click on Finish. All projects should be imported without any errors.</p>
</li>
<li>
<p>Now add the EMS application to the OpenMUC Framework. Navigate openmuc/framework/conf and and following line to bundles.conf.gradle below the openmuc-app-simpledemo entry:</p>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework", name: "openmuc-app-ems",                   version: openmucVersion</pre>
</div>
</div>
</li>
<li>
<p>Finally we build the framework and start our application. Navigate to openmuc/framework/bin and run:</p>
<div class="listingblock">
<div class="content">
<pre>./openmuc update-bundles -i</pre>
</div>
</div>
<div class="paragraph">
<p>This will build all bundles and copies them to /openmuc/framework/bundles. Our EMS app should be now inside this folder e.g. openmuc-app-ems-&lt;version&gt;.jar</p>
</div>
</li>
<li>
<p>Start the framework with:</p>
<div class="listingblock">
<div class="content">
<pre>./openmuc start -fg</pre>
</div>
</div>
</li>
<li>
<p>The log messages of our EMS application are now visible in the terminal e.g:</p>
<div class="listingblock">
<div class="content">
<pre>2018-12-17 19:10:20.015 [...] INFO  o.o.framework.app.simpledemo.EmsApp - &gt;&gt;&gt; grid power: -1.779
2018-12-17 19:10:25.006 [...] INFO  o.o.framework.app.simpledemo.EmsApp - &gt;&gt;&gt; grid power: -1.761</pre>
</div>
</div>
</li>
<li>
<p>Now you know all the steps to build a new application and get it running in OpenMUC. For further development you should have a look at the source code of the SimpleDemoApp.java.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="anchor-tutorial-webui-plugin">3.3. Develop a Customised WebUI Plugin</h3>
<div class="paragraph">
<p><strong>Objective:</strong> In this tutorial you will learn how to add a plugin to the WebUI as well as how to display data from your configured channels. Examples for such plugins are the <em>simpledemovisualisation</em> bundle or the
<a href="https://www.openmuc.org/projects/heiphoss/">HeiPhoss WebUI</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>This tutorial describes how we developed the simpledemovisualisation. When creating your own plugin you can just replace the name <em>simpledemovisualisation</em> whenever it comes up in the tutorial.</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Preparation:</strong> You should be familiar with OpenMUC&#8217;s <a href="#anchor-architecture">architecture</a>.</p>
</div>
<div class="paragraph">
<p><strong>Step-by-step</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First we have to create a new Project with the Structure</p>
<div class="listingblock">
<div class="content">
<pre>openmuc/projects/webui/simpledemovisualisation</pre>
</div>
</div>
</li>
<li>
<p>Now copy the build.gradle file from one of the existing WebUI plugins, for example:</p>
<div class="listingblock">
<div class="content">
<pre>openmuc/projects/webui/channelaccesstool/build.gradle</pre>
</div>
</div>
<div class="paragraph">
<p>into this project and change the projectName and projectDescription</p>
</div>
<div class="listingblock">
<div class="content">
<pre>def projectName = "OpenMUC WebUI - Simple Demo Visualisation"
def projectDescription = "Simple Demo Visualisation plug-in for the WebUI of the OpenMUC framework."</pre>
</div>
</div>
</li>
<li>
<p>Open openmuc/configuration.gradle and add the following line under distributionProjects = javaProjects.findAll</p>
<div class="listingblock">
<div class="content">
<pre>it.getPath() == ":openmuc-webui-simpledemovisualisation" ||</pre>
</div>
</div>
</li>
<li>
<p>Open openmuc/settings.gradle and add the following line under OpenMUC WebUI Bundles</p>
<div class="listingblock">
<div class="content">
<pre>project(":openmuc-webui-simpledemovisualisation").projectDir = file('projects/webui/simpledemovisualisation')</pre>
</div>
</div>
</li>
<li>
<p>Open openmuc/framework/config/bundles.conf.gradle and add the following line under dependencies</p>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework", name: "openmuc-webui-simpledemovisualisation", version: openmucVersion</pre>
</div>
</div>
<div class="paragraph">
<p>Next we will take a look at how our project should be structured once we are done</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/simpleDemoVisualisationTree.png"><img src="images/simpleDemoVisualisationTree.png" alt="simpleDemoVisualisationTree" width="960"></a>
</div>
</div>
</li>
<li>
<p>First we will take a look at the java file. Recreate the folder structure above and create the java file SimpleDemoVisualisation.java, and then copy this into it</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.openmuc.framework.webui.spi.WebUiPluginService</span>;
<span class="keyword">import</span> <span class="include">org.osgi.service.component.annotations.Component</span>;

<span class="annotation">@Component</span>(service = WebUiPluginService.class)
<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">SimpleDemoVisualisation</span> <span class="directive">extends</span> WebUiPluginService {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getAlias() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">simpledemovisualisation</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Simple Demo Visualisation</span><span class="delimiter">&quot;</span></span>;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two functions getAlias and getName have to be overridden. The alias is used to identify the plugin while the name will be displayed in the WebUI. In order to display an icon above the plugin&#8217;s name, the file needs to be called icon and put in the images folder.</p>
</div>
</li>
<li>
<p>Next we will take a look at app.js and app.routes.js. In app.js all we do is creating a module and naming it.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">(<span class="keyword">function</span>(){
        angular.module(<span class="string"><span class="delimiter">'</span><span class="content">openmuc.openmuc-visu</span><span class="delimiter">'</span></span>, []);
})();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The more interesting one is app.routes.js because it is responsible for allowing us to get from the main page to the page of our plugin. It also allows us to specify which files have to be loaded.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">(<span class="keyword">function</span>(){

    <span class="keyword">var</span> app = angular.module(<span class="string"><span class="delimiter">'</span><span class="content">openmuc</span><span class="delimiter">'</span></span>);

    app.config([<span class="string"><span class="delimiter">'</span><span class="content">$stateProvider</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$urlRouterProvider</span><span class="delimiter">'</span></span>,
        <span class="keyword">function</span>(<span class="predefined">$stateProvider</span>, <span class="predefined">$urlRouterProvider</span>) {
            <span class="predefined">$stateProvider</span>.
            state(<span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation</span><span class="delimiter">'</span></span>, {
                <span class="key">url</span>: <span class="string"><span class="delimiter">'</span><span class="content">/simpledemovisualisation</span><span class="delimiter">'</span></span>,
                <span class="key">templateUrl</span>: <span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation/html/index.html</span><span class="delimiter">'</span></span>,
                <span class="key">requireLogin</span>: <span class="predefined-constant">true</span>
            }).
            state(<span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation.index</span><span class="delimiter">'</span></span>, {
                <span class="key">url</span>: <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>,
                <span class="key">templateUrl</span>: <span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation/html/graphic.html</span><span class="delimiter">'</span></span>,
                <span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">VisualisationController</span><span class="delimiter">'</span></span>,
                <span class="key">requireLogin</span>: <span class="predefined-constant">true</span>,
                <span class="key">resolve</span>: {
                    <span class="function">openmuc</span>: <span class="keyword">function</span> (<span class="predefined">$ocLazyLoad</span>) {
                        <span class="keyword">return</span> <span class="predefined">$ocLazyLoad</span>.load(
                            {
                                <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">openmuc.simpledemovisualisation</span><span class="delimiter">'</span></span>,
                                <span class="key">files</span>: [<span class="string"><span class="delimiter">'</span><span class="content">openmuc/js/channels/channelsService.js</span><span class="delimiter">'</span></span>,
                                    <span class="string"><span class="delimiter">'</span><span class="content">openmuc/js/channels/channelDataService.js</span><span class="delimiter">'</span></span>,
                                    <span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation/css/simpledemovisualisation/main.css</span><span class="delimiter">'</span></span>,
                                   <span class="string"><span class="delimiter">'</span><span class="content">simpledemovisualisation/js/visu/VisualisationController.js</span><span class="delimiter">'</span></span>]
                            }
                        )
                    }
                }
            })
        }]);

})();</code></pre>
</div>
</div>
<div class="paragraph">
<p>All files you need have to be added to the list "files" in order for the plugin to work. The first two files we load are necessary to access the defined channels. Then we load in our css file and lastly the javascript file of this plugin.</p>
</div>
</li>
<li>
<p>For the Plugin created in this tutorial we will need an svg that is put into the image folder. The SimpleDemoGraphic.svg used in this tutorial is made up of multiple images, paths as well as text fields. In this case only the text fields are of interest.</p>
</li>
<li>
<p>The two html files used in this app are very simple, index.html sets the headline and then calls on graphic.html through ui-view. Ui-view calls upon the route defined in app.routes.js.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="HTML"><span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">page-header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h1&gt;</span>OpenMUC Visualisation<span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">ui-view</span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In graphic.html we create a div element and assign it the class svg-container. We then create an object HTML element inside the div and assign it the class svg-content.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="HTML"><span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">svg-container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;object</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleDemoGraphic</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">image/svg+xml</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">data</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpledemovisualisation/images/SimpleDemoGraphic.svg</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">svg-content</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">onload</span>=<span class="string"><span class="delimiter">&quot;</span>display_visualisation()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/object&gt;</span>
<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Further we also assign it an Id, in this case simpleDemoGraphic, specify that it is of the type svg and tell it where our svg is located. This way our svg is now displayed on the page, but in order to change elements of the svg we need a javascript function which is called through onload.</p>
</div>
</li>
<li>
<p>In order to specify how our page should be displayed we use a css file.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CSS"><span class="tag">html</span>, <span class="tag">body</span> {
    <span class="key">font-family</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Arial</span><span class="delimiter">&quot;</span></span>;
    <span class="key">margin</span>: <span class="float">0px</span>;
    <span class="key">padding</span>: <span class="float">0px</span>;
}

<span class="class">.svg-container</span> {
    <span class="key">display</span>: <span class="value">inline-block</span>;
    <span class="key">position</span>: <span class="value">relative</span>;
    <span class="key">width</span>: <span class="float">1108px</span>;
    <span class="key">height</span>: <span class="float">760px</span>;
    <span class="key">border</span>:<span class="float">1px</span> <span class="value">solid</span> <span class="value">black</span>;
}

<span class="class">.svg-content</span> {
    <span class="key">display</span>: <span class="value">block</span>;
    <span class="key">position</span>: <span class="value">absolute</span>;
    <span class="key">width</span>: <span class="float">1106px</span>;
    <span class="key">height</span>: <span class="float">740px</span>;
    <span class="key">top</span>: <span class="float">0</span>;
    <span class="key">left</span>: <span class="float">0</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this css file we tell the browser how the html elements should look and be positioned. If the declaration starts with a dot it signifies all elements with the specified class being targeted, a hash would signify an element with that Id being targeted and nothing signifies all html elements of that type should be targeted.</p>
</div>
</li>
<li>
<p>By default the svg will have an eight pixel margin on each side, meaning there will be white space between the border and svg. If you dont want that you need to open the svg in a text editor and add a style tag after the svg tag as shown below</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="HTML"><span class="tag">&lt;svg</span>
   <span class="attribute-name">xmlns:osb</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.openswatchbook.org/uri/2009/osb</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:dc</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://purl.org/dc/elements/1.1/</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:cc</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://creativecommons.org/ns#</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:rdf</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/02/22-rdf-syntax-ns#</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:svg</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2000/svg</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2000/svg</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:xlink</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xlink</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:sodipodi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:inkscape</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.inkscape.org/namespaces/inkscape</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">viewBox</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0 0 573.61664 357.1875</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">svg8</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">inkscape:version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.92.3 (2405546, 2018-03-11)</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">sodipodi:docname</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SimpleDemoGraphic.svg</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;style</span>
     <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/css</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">media</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">screen</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">style5004</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="inline"><span class="error">&lt;</span><span class="error">!</span>[<span class="attribute-name">CDATA[
      body{
         margin: 0px;
      }
    </span>]<span class="error">]</span>&gt;</span><span class="tag">&lt;/style&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We cannot change the css of the svg from our css file so we have to do it inside the svg.</p>
</div>
</li>
<li>
<p>Finally we take a look at the javascript file that will allow us to display data in real time.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">(<span class="keyword">function</span>(){

    <span class="keyword">var</span> injectParams = [<span class="string"><span class="delimiter">'</span><span class="content">$scope</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">$interval</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ChannelsService</span><span class="delimiter">'</span></span>];

    <span class="keyword">var</span> <span class="function">VisualisationController</span> = <span class="keyword">function</span>(<span class="predefined">$scope</span>, <span class="predefined">$interval</span>, ChannelsService) {
        <span class="keyword">var</span> svg_document;

        <span class="function">display_visualisation</span> = <span class="keyword">function</span>() {</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we "import" the angular functions $scope and $interval as well as the class ChannelsService. Next we take a look at the function display_visualisation that is called when the html page loads.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">svg_document = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">simpleDemoGraphic</span><span class="delimiter">'</span></span>).contentDocument;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Through this line of code we now have access to the svg in javascript. We achieve this by calling document.getElementById with the id of our object element as a parameter. The contentDocument means that the return value is the document object, otherwise the return would have just been the content of the document, in which case we could not use it in the way we need to later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">    <span class="predefined">$scope</span>.interval = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
    <span class="predefined">$interval</span>.cancel(<span class="predefined">$scope</span>.interval);
    <span class="predefined">$scope</span>.interval = <span class="predefined">$interval</span>(<span class="keyword">function</span>(){
        ...
    }, <span class="integer">500</span>);
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>What follows is defined inside this interval, meaning it will be repeated every 500 milliseconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">ChannelsService.getAllChannels().then(async <span class="keyword">function</span>(channels) {
                    <span class="predefined">$scope</span>.channels = await channels.records;
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we call the function getAllChannels of the class ChannelsService. It makes a get call to the REST server and returns all the channels defined in the channels.xml. The "then" means that whatever is in the round brackets will be executed after getAllChannels' return value arrives. Inside these round brackets we define an async function with getAllChannels' return value as a parameter. The list records of the return value contains the requested channels, so we save them in the list $scope.channels. Normally the rest of the code would be exectued while getAllChannels waits for a reply, in which case our code would fail as $scope.channels would be undefined, but the await keyword in conjunction with marking the function as async makes it so the code only resumes executing once the await has been resolved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">if</span> (<span class="predefined">$scope</span>.channels != <span class="predefined-constant">undefined</span>){
    <span class="predefined">$scope</span>.channels.forEach(<span class="keyword">function</span>(channel){
        <span class="keyword">if</span> (channel.id === <span class="string"><span class="delimiter">&quot;</span><span class="content">power_heatpump</span><span class="delimiter">&quot;</span></span>){
            textHeatPump = svg_document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">textHeatPump</span><span class="delimiter">&quot;</span></span>);
            textHeatPump.textContent = channel.record.value + <span class="string"><span class="delimiter">&quot;</span><span class="content"> kW</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="keyword">if</span> (channel.id === <span class="string"><span class="delimiter">&quot;</span><span class="content">power_electric_vehicle</span><span class="delimiter">&quot;</span></span>){
            textChargingStation = svg_document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">textChargingStation</span><span class="delimiter">&quot;</span></span>);
            textChargingStation.textContent = channel.record.value + <span class="string"><span class="delimiter">&quot;</span><span class="content"> kW</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="keyword">if</span> (channel.id === <span class="string"><span class="delimiter">&quot;</span><span class="content">power_photovoltaics</span><span class="delimiter">&quot;</span></span>){
            textPv = svg_document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">textPv</span><span class="delimiter">&quot;</span></span>);
            textPv.textContent = channel.record.value + <span class="string"><span class="delimiter">&quot;</span><span class="content"> kW</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="keyword">if</span> (channel.id === <span class="string"><span class="delimiter">&quot;</span><span class="content">power_grid</span><span class="delimiter">&quot;</span></span>){
            textGrid = svg_document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">textGrid</span><span class="delimiter">&quot;</span></span>);
            textGrid.textContent = channel.record.value + <span class="string"><span class="delimiter">&quot;</span><span class="content"> kW</span><span class="delimiter">&quot;</span></span>;
        }
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First we check if our list is not undefined as it is possible that the during the first interval there wont be any data to work with. Now we iterate through our channels list to find the channels we need. Once we found the right channel, we search for the corresponding text field and save the reference to it in a variable. By setting the textContent of the text field we can change what is displayed, in this case the channel&#8217;s value is displayed in the text field. Now we set the interval and close the function definition as shown above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">        <span class="predefined">$scope</span>.<span class="predefined">$on</span>(<span class="string"><span class="delimiter">'</span><span class="content">$destroy</span><span class="delimiter">'</span></span>, <span class="keyword">function</span> () {
            <span class="predefined">$interval</span>.cancel(<span class="predefined">$scope</span>.interval);
        });

        };

    VisualisationController.<span class="predefined">$inject</span> = injectParams;

    angular.module(<span class="string"><span class="delimiter">'</span><span class="content">openmuc.openmuc-visu</span><span class="delimiter">'</span></span>).controller(<span class="string"><span class="delimiter">'</span><span class="content">VisualisationController</span><span class="delimiter">'</span></span>, VisualisationController);

})();</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that we tell the function to stop the interval if the scope&#8217;s destroy event is triggered and that the in app.js defined module should use this controller.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Tips</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you want to change the css of the svg at runtime you can do so through javascript similarly to the manipulation of the text field above.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">textHeatPump.style.fill = <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would set the text color of the text field to blue</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="anchor-architecture">4. Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following image depicts the software layers of an OpenMUC
system.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/openmuc-software-layers.png"><img src="images/openmuc-software-layers.png" alt="openmuc software layers" width="60%"></a>
</div>
<div class="title">Figure 11. OpenMUC software layers</div>
</div>
<div class="paragraph">
<p>The OpenMUC framework runs within an OSGi environment which in turn is
being run by a Java Virtual Machine. The underlying operating system
and hardware can be chosen freely as long as it can run a Java 7 VM.</p>
</div>
<div class="paragraph">
<p>OpenMUC consists essentially of various software modules which are
implemented as OSGi bundles that run in the OSGi environment and
communicate over OSGi services. The following figure illustrates the
main modules that make up OpenMUC.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/openmuc-bundles-with-numbers.png"><img src="images/openmuc-bundles-with-numbers.png" alt="openmuc bundles with numbers" width="60%"></a>
</div>
<div class="title">Figure 12. OpenMUC modules</div>
</div>
<div class="paragraph">
<p>All modules except for the data manager are optional. Thus by
selecting the modules you need you can easily create your own
customized and lightweight system.</p>
</div>
<div class="paragraph">
<p>The different modules in the picture are now further explained:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <strong>data manager</strong> represents the core and center of
OpenMUC. Virtually all other OpenMUC modules (e.g. drivers, data
loggers, servers, applications and web interface plugins) communicate
with it through OSGi services. The data manager gets automatically
notified when new drivers or data loggers get installed. OpenMUC
applications communicate with devices, access logged data or change
the configuration by calling service functions provided by the data
manager. It is therefore the data manager that shields the application
programmer from the details of the communication and data logging
technology. What the data manager does is mostly controlled through a
central configuration.</p>
</li>
<li>
<p>The <strong>channel configuration</strong> holds the user defined data channels and
its parameters. Data channels are the frameworks
representation of data points in connected devices. Amongst others the
channel configuration holds the following information:</p>
<div class="openblock">
<div class="content">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>communication parameters that the drivers require</p>
</li>
<li>
<p>when to sample new data from connected devices</p>
</li>
<li>
<p>when to send sampled data to existing data logger(s)
for efficient persistent storage.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The configuration is stored in the file
conf/channels.xml. You may add or modify the configured channels by
manually editing the channels.xml file or through the channel
configurator web interface.</p>
</div>
</div>
</div>
</li>
<li>
<p>A <strong>driver</strong> is used by the data manager to send/get data to/from a
connected device. Thus a driver usually implements a communication
protocol. Several communication drivers have already been developed
(e.g. IEC 61850, ModbusTCP, KNX, DLMS/COSEM). Many drivers use
standalone communication libraries (e.g. OpenIEC61850, jMBus)
developed by the OpenMUC team. These libraries do not depend on the
OpenMUC framework and can therefore be used by any Java
application. New communication drivers for OpenMUC can be easily
developed by third parties.</p>
</li>
<li>
<p>A <strong>data logger</strong> saves sampled data persistently. The data manager
forwards sampled data to all available data loggers if configured to
do so. Data loggers are specifically designed to store time series
data for short storage and retrieval times. Note that this usually
means that they are not SQL-based. OpenMUC currently includes two data
loggers. The ASCII data logger saves data in a human readable text
format while SlotsDB saves data in a more efficient binary format.</p>
</li>
<li>
<p>If all you want is sample and log data then you can use the OpenMUC
framework as it is and simply configure it to your needs. But if you
want to process sampled data or control a device you will want to
write your own <strong>application</strong>. Like all other modules your application
will be an OSGi bundle. In your application you can use the
DataAccessService and the ConfigService provided by the data manager
to access sampled and logged data. You may also issue immediate read
or write commands. These are forwarded by the data manager to the
driver. The configuration (when to sample and to log) can also be
changed during run-time by the application. At all times the
application only communicates with the data manager and is therefore
not confronted with the complicated details of the communication
technology being used.</p>
</li>
<li>
<p>If your application is located on a remote system (e.g. a smart
phone or an Internet server) then the data and configuration can be
accessed through an OpenMUC <strong>server</strong>. At the moment OpenMUC provides a
RESTful web service for this purpose.</p>
</li>
<li>
<p>Finally the OpenMUC framework provides a web user interface
(<strong>WebUI</strong>) for tasks such as configuration, visualization of sampled
data or exporting logged data. The web interface is modular and
provides a plug-in interface. This way developers may write a website
that integrates into the main menu of the web interface. The WebUI is
mostly for configuration and testing purposes. Most companies will
want to create their own individual UI.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_file_structure_of_the_distribution">4.1. File Structure of the Distribution</h3>
<div class="paragraph">
<p>The distribution contains the following important files and folders:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">build/libs-all</dt>
<dd>
<p>All modules/bundles that make up the OpenMUC framework</p>
</dd>
<dt class="hdlist1">dependencies</dt>
<dd>
<p>Information on the external dependencies of the OpenMUC
framework. Also contains the RXTX library (repacked as a bundle)
which is needed by many OpenMUC drivers based on serial
communication.</p>
</dd>
<dt class="hdlist1">projects</dt>
<dd>
<p>All sources of the OpenMUC framework. You can easily change and
rebuild OpenMUC using Gradle.</p>
</dd>
<dt class="hdlist1">framework</dt>
<dd>
<p>A ready to use OpenMUC demo framework that is introduced next.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_framework_files">4.2. Framework Files</h3>
<div class="paragraph">
<p>The folder "framework" contains a configured OpenMUC framework that
can be used as a basis to create your own customized OpenMUC framework
for your task. The framework folder contains the following important
files and folders:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">felix</dt>
<dd>
<p>The main Apache Felix OSGi jar which is run to start OpenMUC.</p>
</dd>
<dt class="hdlist1">bin</dt>
<dd>
<p>Run scripts for Linux/Unix and Windows.</p>
</dd>
<dt class="hdlist1">bundle</dt>
<dd>
<p>Contains all bundles that are started by the Felix OSGi
framework. Note that this folder does not contain all available
OpenMUC bundles but only a subset for demonstration purposes.</p>
</dd>
<dt class="hdlist1">log</dt>
<dd>
<p>Log files produced by the running framework.</p>
</dd>
<dt class="hdlist1">conf</dt>
<dd>
<p>Various configuration files of the framework.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_devices_and_channels">4.3. Devices and Channels</h3>
<div class="paragraph">
<p>OpenMUC works on the basis of channels. A channel basically represents
a single data point. Some examples for a channel are the metered
active power of a smart meter, the temperature of a temperature
sensor, any value of digital or analog I/O module or the some
manufacture data of the device. Thus a channel can represent any kind
of data point. The following picture illustrates the channel concept.</p>
</div>
<div class="paragraph">
<div class="title">OpenMUCs Channel Concept</div>
<p><span class="image"><a class="image" href="images/openmuc_concept.png"><img src="images/openmuc_concept.png" alt="OpenMUC channel concept" width="60%"></a></span></p>
</div>
</div>
<div class="sect2">
<h3 id="anchor-configuration">4.4. Configuration via channels.xml</h3>
<div class="paragraph">
<p>The <strong>conf/channels.xml</strong> file is the main configuration file for
OpenMUC. It tells the OpenMUC framework which channels it should log
and sample. It contains a hierarchical structure of drivers, devices
and channels. A driver can have one or more devices and devices can
have one or more channels. Following listing shows a sample
configuration to illustrate the hierarchical structure. The driver,
device and channel options are explained afterwards.</p>
</div>
<div class="listingblock">
<div class="title">channels.xml structure</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>
<span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;logger&gt;</span>loggerId<span class="tag">&lt;/logger&gt;</span>

        <span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">driver_x</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="comment">&lt;!-- driver options --&gt;</span>
                <span class="tag">&lt;device&gt;</span>
                        <span class="comment">&lt;!-- device options --&gt;</span>
                        <span class="tag">&lt;channel&gt;</span>
                                <span class="comment">&lt;!-- channel options --&gt;</span>
                        <span class="tag">&lt;/channel&gt;</span>
                        <span class="tag">&lt;channel&gt;</span>
                                <span class="comment">&lt;!-- channel options --&gt;</span>
                        <span class="tag">&lt;/channel&gt;</span>
                <span class="tag">&lt;/device&gt;</span>
        <span class="tag">&lt;/driver&gt;</span>
<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. <strong>Driver options</strong></caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id of the driver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default time waited for a read operation to complete if the device doesn&#8217;t set a samplingTimeout on its own.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectRetryInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default time waited until a failed connection attempt is repeated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">While disabled, no connections to devices on this driver are established at all and all channels of these devices stop being sampled and logged.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. <strong>Device options</strong></caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the device.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deviceAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address for the driver to uniquely identify the device. Syntax of this address is up to the driver implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description of the device.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional settings for the driver. Syntax is up to the driver implementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time waited for a read operation to complete. Overwrites samplingTimeout of Driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectRetryInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time waited until a failed connection attempt is repeated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">While disabled, no connection of this device is established and all channels of this device stop being sampled and logged.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. <strong>Channel options</strong></caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Globally unique identifier. Used by data logger implementations. The OpenMUC framework automatically generates an id if none is provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description of the channel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">channelAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The channelAddress is driver specific and contains the necessary parameters for the driver to access.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOUBLE  FLOAT  LONG  INTEGER  SHORT  BYTE  BOOLEAN  BYTE_ARRAY STRING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOUBLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data type of the channel. Used on data logger. Driver implementation do NOT receive this settings!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueType Attribute: <em>length</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The attribute <em>length</em> is only used if valueType is BYTE_ARRAY or STRING. Determines the maximum length of the byte array or string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scalingFactor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is used to scale a value read by a driver or set by an application. The value read by an driver is multiplied with the scalingFactor and a value set by an application is divided by the scalingFactor. Possible values are e.g.: 1.0 4.94147E-9 -2.4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueOffset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is used to offset a value read by a driver or set by an application. The offset is added to a value read by a driver and subtracted from a value set by an application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical unit of this channel. For information only (info can be accessed by an app or driver)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time difference until this channel is logged again. -1 or omitting loggingInterval disables logging.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggingTimeOffset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listening</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines if this channel shall passively listen for incoming value changes from the driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time interval between two attempts to read this channel. -1 or omitting samlingOffset disables sampling on this channel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingTimeOffset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For grouping channels. All channels with the same samplingGroup and same samplingInterval are in one group. The purpous of samplingGroups is to improve the drivers performance - if possible.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a channel is disabled, all sampling and logging actions of this channel are stopped.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>*time: integer with suffix (ms, s, m, h) like: 300ms, 2s.</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>if you don&#8217;t use a suffix, then ms is automatically used</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The available driver settings, device settings and channel settings
can also be found in the
<a href="https://www.openmuc.org/openmuc/javadoc/">Javadoc</a> of
DriverConfig.java, DeviceConfig.java and ChannelConfig.java
respectively.</p>
</div>
<div class="paragraph">
<p><strong>Default Data Logger</strong></p>
</div>
<div class="paragraph">
<p>You can define a default data logger by adding a logger element with
the id of a data logger to the configuration. If available, that data
logger is used to read logged values. The ids of data loggers shipped
with the OpenMUC Framework are defined in the "Data Loggers"
chapter. If no logger with the defined id is available, or the logger
element is missing from the configuration, an arbitrary available
logger is used to read logged values. Only one default logger may be
defined. If multiple logger elements exists, only the first one is
evaluated.</p>
</div>
<div class="paragraph">
<p>This configuration only affects reading of already logged
values. Channels are still logged by all available loggers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sampling_listening_and_logging">4.5. Sampling, Listening and Logging</h3>
<div class="ulist">
<ul>
<li>
<p><strong>sampling</strong> is when the data manager frequently asks a driver to
retrieve a channel value.</p>
</li>
<li>
<p><strong>listening</strong> is when the driver listens on a channel and forwards new
values to the data manager.</p>
</li>
<li>
<p><strong>logging</strong> is when the data manager forwards the current sampled
value to the data loggers that are installed. The data loggers then
store the data persistently</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following examples will give you a better understanding of these
three settings.</p>
</div>
<div class="listingblock">
<div class="title">Example 1: Just Sampling</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channel&gt;</span>
        <span class="tag">&lt;id&gt;</span>channel1<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;channelAddress&gt;</span>dummy/channel/address/1<span class="tag">&lt;/channelAddress&gt;</span>
        <span class="tag">&lt;samplingInterval&gt;</span>4s<span class="tag">&lt;/samplingInterval&gt;</span>
<span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In example 1 the channel is sampled every 4 seconds which means the
data manager requests every 4 seconds the current value from the
driver.</p>
</div>
<div class="listingblock">
<div class="title">Example 2: Sampling and Logging</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channel&gt;</span>
        <span class="tag">&lt;id&gt;</span>channel2<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;channelAddress&gt;</span>dummy/channel/address/2<span class="tag">&lt;/channelAddress&gt;</span>
        <span class="tag">&lt;samplingInterval&gt;</span>4s<span class="tag">&lt;/samplingInterval&gt;</span>
        <span class="tag">&lt;loggingInterval&gt;</span>8s<span class="tag">&lt;/loggingInterval&gt;</span>
<span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 2 extends example 1 by an additional logging. The logging
interval is set to 8 seconds which means that every 8 seconds the last
sampled value is stored in the database. In this case every second
sampled value is stored because the sampling interval is 4 seconds. To
log every sampled value the sampling interval and logging interval
need to be the same.</p>
</div>
<div class="listingblock">
<div class="title">Example 3: Just Listening</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channel&gt;</span>
        <span class="tag">&lt;id&gt;</span>channel3<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;channelAddress&gt;</span>dummy/channel/address/3<span class="tag">&lt;/channelAddress&gt;</span>
        <span class="tag">&lt;listening&gt;</span>true<span class="tag">&lt;/listening&gt;</span>
<span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In example 3 listening instead of sampling is used. This means that the driver
reports a new channel value to the data manager when the value has changed for example.</p>
</div>
<div class="listingblock">
<div class="title">Example 4: Listening and Logging</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;channel&gt;</span>
        <span class="tag">&lt;id&gt;</span>channel4<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;channelAddress&gt;</span>dummy/channel/address/4<span class="tag">&lt;/channelAddress&gt;</span>
        <span class="tag">&lt;listening&gt;</span>true<span class="tag">&lt;/listening&gt;</span>
        <span class="tag">&lt;loggingInterval&gt;</span>8s<span class="tag">&lt;/loggingInterval&gt;</span>
<span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example 4 extends example 3 by an additional logging.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When listening is true and additional a sampling interval is defined then the sampling is ignored.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="anchor-start-script">5. OpenMUC start script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To start OpenMUC on Linux run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc start</pre>
</div>
</div>
<div class="paragraph">
<p>This runs OpenMUC as a background process. If you want to run OpenMUC
in the foreground run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc start -fg</pre>
</div>
</div>
<div class="paragraph">
<p>To start OpenMUC under Window run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bin\openmuc.bat</pre>
</div>
</div>
<div class="paragraph">
<p>The Linux start script is a sophisticated bash script that can be used
to start, stop, restart OpenMUC. The Windows run script is a simple
bat file that starts OpenMUC. The following explanations will focus on
using OpenMUC in a Linux environment as it is the more common
scenario.</p>
</div>
<div class="paragraph">
<p>Starting OpenMUC really means running the Felix OSGi Framework by
executing</p>
</div>
<div class="paragraph">
<p>java -jar felix/felix.jar</p>
</div>
<div class="paragraph">
<p>The Felix OSGi Framework will then start all bundles located in the
"bundle" folder.</p>
</div>
<div class="paragraph">
<p>When you start OpenMUC in the foreground you will enter the Felix Gogo
shell. From the shell you can start, stop and reload bundles among
many other things. To quit the shell and stop the framework press
ctrl+d or enter "stop 0".</p>
</div>
<div class="paragraph">
<p>If OpenMUC was started as a background process you can access the Gogo
shell using telnet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>netcat 127.0.0.1 6666</pre>
</div>
</div>
<div class="paragraph">
<p>or using the openmuc run script</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc remote-shell</pre>
</div>
</div>
<div class="paragraph">
<p>Pressing ctrl+d will exit the remote shell but not stop the openmuc framework.</p>
</div>
<div class="paragraph">
<p>To stop OpenMUC run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc stop</pre>
</div>
</div>
<div class="paragraph">
<p>To reload a new configuration without restarting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc reload</pre>
</div>
</div>
<div class="paragraph">
<p>To restart a running OpenMUC (stop/start):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc restart</pre>
</div>
</div>
<div class="paragraph">
<p>To update the bundles in the bundle folder after e.g. changing bundles.conf.gradle
Before using this the first time see the next point.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc update-bundles</pre>
</div>
</div>
<div class="paragraph">
<p>For building and installing the sources of OpenMUC with updating the bundles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./bin/openmuc update-bundles -i</pre>
</div>
</div>
<div class="sect2">
<h3 id="_auto_start_at_boot_time">5.1. Auto-start at Boot Time</h3>
<div class="paragraph">
<p>On Debian based Linux distributions it is easy to configure automatic
start of OpenMUC at boot time. As root execute the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ln -s /path/to/openmuc/bin/openmuc /etc/init.d/openmuc
update-rc.d openmuc defaults</pre>
</div>
</div>
<div class="paragraph">
<p>The above solution will not work if the openmuc start script is
located on a partion that is not yet mounted at the time the boot
process attempts to open it. In this case you need copy the start
script to /etc/init.d/ and edit it to set the OPENMUC_HOME variable.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="drivers">6. Drivers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_install_a_driver">6.1. Install a Driver</h3>
<div class="paragraph">
<p>For installing a new driver you have two possible ways.</p>
</div>
<div class="sect3">
<h4 id="_copy_driver">6.1.1. Copy driver</h4>
<div class="paragraph">
<p>Copy the corresponding driver jar file from the folder "build/libs-all/" to the
"bundle" folder of the framework. Many drivers are "fat jars" which include their
dependencies. An exception is the RXTX library which cannot be packed
with the jars.</p>
</div>
</div>
<div class="sect3">
<h4 id="_editing_bundles_configuration">6.1.2. Editing bundles configuration</h4>
<div class="paragraph">
<p>In /openmuc/framework/conf/bundles.conf.gradle you can find the list of all used
bundles e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework", name: "openmuc-driver-csv", version: openmucVersion

osgibundles group: "org.openmuc.framework", name: "openmuc-webui-spi",  version: openmucVersion
osgibundles group: "org.openmuc.framework", name: "openmuc-webui-base", version: openmucVersion</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to add a new driver to the list, e.g. M-Bus, you can do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>osgibundles group: "org.openmuc.framework", name: "openmuc-driver-csv",  version: openmucVersion
osgibundles group: "org.openmuc.framework", name: "openmuc-driver-mbus", version: openmucVersion
osgibundles group: "org.openmuc",           name: "jrxtx",               version: "1.0.1"

osgibundles group: "org.openmuc.framework", name: "openmuc-webui-spi",   version: openmucVersion
osgibundles group: "org.openmuc.framework", name: "openmuc-webui-base",  version: openmucVersion</pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards you have to execute in /openmuc/framework/bin/</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./openmuc update-bundles</pre>
</div>
</div>
<div class="paragraph">
<p>If this is the first time using ./openmuc update-bundles you have to add the parameter -i</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./openmuc update-bundles -i</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_use_a_driver_with_serial_communication">6.1.3. Use a Driver with Serial Communication</h4>
<div class="paragraph">
<p>When you need to use a driver that uses serial communication you have
to copy the RXTX bundle to the frameworks "bundle" folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cp ../dependencies/rxtx/jrxtx-1.0.1.jar ./bundle/</pre>
</div>
</div>
<div class="paragraph">
<p>Additionally you need to install librxtx-java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo apt-get install librxtx-java</pre>
</div>
</div>
<div class="paragraph">
<p>The serial ports /dev/tty* are only accessible to members belonging to
the group dialout. We therefore have to add our user to that
group. E.g. using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo adduser &lt;yourUserName&gt; dialout</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modbus">6.2. Modbus</h3>
<div class="paragraph">
<p>Modbus Homepage: <a href="http://www.modbus.org" class="bare">http://www.modbus.org</a><br>
Modbus Protocol Specifications: <a href="http://www.modbus.org/specs.php" class="bare">http://www.modbus.org/specs.php</a><br>
Modbus Master Simulator modpoll: <a href="http://www.modbusdriver.com/modpoll.html" class="bare">http://www.modbusdriver.com/modpoll.html</a></p>
</div>
<div class="paragraph">
<p>The Modbus driver supports RTU, TCP and RTU over TCP.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><strong>TCP</strong> (ethernet)</th>
<th class="tableblock halign-left valign-top"><strong>RTU</strong> (serial)</th>
<th class="tableblock halign-left valign-top"><strong>RTUTCP</strong> (serial over ethernet)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">modbus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;ip&gt;[:&lt;port&gt;]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;serial port&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;ip&gt;[:&lt;port&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;type&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;type&gt;:&lt;encoding&gt;:&lt;baudrate&gt;:&lt;databits&gt;:&lt;parity&gt;:&lt;stopbits&gt;:
&lt;echo&gt;:&lt;flowControlIn&gt;:&lt;flowControlOut&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;type&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">&lt;UnitId&gt;:&lt;PrimaryTable&gt;:&lt;Address&gt;:&lt;Datatyp&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>DeviceAddress</strong></p>
</div>
<div class="paragraph">
<p><strong>For TCP and RTUTCP</strong><br>
The DeviceAddress is specified by an IP address and an optional port. If no port
 is specified, the driver uses the modbus default port 502.</p>
</div>
<div class="paragraph">
<p><strong>For RTU:</strong><br>
The DeviceAddress is specified by a serial port like /dev/ttyS0.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The driver uses the jamod library which itself uses the rxtx library for
serial communication. Therefor the librxtx-java package needs to be installed on
the system. Furthermore the user needs to be in the groups dialout and plugdev
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Settings</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Config</th>
<th class="tableblock halign-left valign-top">Description/ Values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;type&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RTU|TCP|RTUTCP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;encoding&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERIAL_ENCODING_RTU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;baudrate&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer value: e.g.: 2400, 9600, 115200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;databits&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DATABITS_5, DATABITS_6, DATABITS_7, DATABITS_8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;parity&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PARITY_EVEN, PARITY_MARK, PARITY_NONE, PARITY_ODD, PARITY_SPACE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;stopbits&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STOPBITS_1, STOPBITS_1_5, STOPBITS_2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;echo&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECHO_TRUE, ECHO_FALSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;flowControlIn&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLOWCONTROL_NONE, FLOWCONTROL_RTSCTS_IN, FLOWCONTROL_XONXOFF_IN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;flowControlOut&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLOWCONTROL_NONE, FLOWCONTROL_RTSCTS_OUT, FLOWCONTROL_XONXOFF_OUT</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example Settings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;settings&gt;</span>
RTU:SERIAL_ENCODING_RTU:38400:DATABITS_8:PARITY_NONE:STOPBITS_1 :ECHO_FALSE:FLOWCONTROL_NONE:FLOWCONTROL_NONE
<span class="tag">&lt;/settings&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>ChannelAddress</strong></p>
</div>
<div class="paragraph">
<p>The ChannelAddress consists of four parts: UnitId, PrimaryTable, Address and
Datatyp which are explained in detail in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Parameter Description</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UnitId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In homogenious architecture (when just MODBUS TCP/IP is used)<br>
On TCP/IP, the MODBUS server is addressed by its IP address; therefore, the MODBUS
Unit Identifier is useless. The value 255 (0xFF) has to be used.</p>
<p class="tableblock">In heterogeneous architecture (when using MODBUS TCP/IP and MODBUS serial or MODBUS+)<br>
This field is used for routing purpose when addressing a device on a MODBUS+ or
MODBUS serial line sub-network. In that case, the “Unit Identifier” carries the MODBUS slave address of the remote device. The MODBUS slave device addresses on serial line are assigned from 1 to 247 (decimal). Address 0 is used as broadcast address.</p>
<p class="tableblock">Note: Some MODBUS devices act like a bridge or a gateway and require the UnitId
even if they are accessed through TCP/IP. One of those devices is the Janitza
UMG. To access data from the Janitza the UnitId has to be 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PrimaryTable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PrimaryTable defines the which part of the device memory should
be accessed.
Valid values: COILS, DISCRETE_INPUTS, INPUT_REGISTERS, HOLDING_REGISTERS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address of the channel/register. Decimal integer value - not hex!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datatyp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid values:<br>
BOOLEAN  (1 bit)<br>
INT16    (1 register/word, 2 bytes)<br>
UINT16   (1 register/word, 2 bytes)<br>
INT32    (2 registers/words, 4 bytes)<br>
UINT32   (2 registers/words, 4 bytes)<br>
LONG     (4 registers/words, 8 bytes)<br>
FLOAT    (2 registers/words, 4 bytes)<br>
DOUBLE   (4 registers/words, 8 bytes)<br>
BYTEARRAY[n] (n = number of REGISTERS not BYTES, 1 register = 2 bytes!)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Primary Tables and Channel Address</div>
<p><span class="image"><a class="image" href="../images/driver_modbustcp_address.png"><img src="images/driver_modbustcp_address.png" alt="Driver Modbus Address" width="80%"></a></span></p>
</div>
<div class="paragraph">
<p><strong>Valid Address Parameter Combinations</strong></p>
</div>
<div class="paragraph">
<p>Since COILS and DISCRETE_INPUTS are used for bit access, only the data type BOOLEAN
makes sense in combinations with of one of these. INPUT_REGISTERS and HOLDING_REGISTERS
are used for register access. There is also a difference between reading and writing.
Only COILS and HOLDING_REGISTERS are readable and writable.
DISCRETE_INPUTS and INPUT_REGISTERS are read only. The following table gives an
overview of valid parameter combinations of PrimaryTable and Datatyp.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Valid Address Parameters for reading a channel</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Primary Table</th>
<th class="tableblock halign-center valign-top">BOOLEAN</th>
<th class="tableblock halign-center valign-top">SHORT</th>
<th class="tableblock halign-center valign-top">INT</th>
<th class="tableblock halign-center valign-top">FLOAT</th>
<th class="tableblock halign-center valign-top">DOUBLE</th>
<th class="tableblock halign-center valign-top">LONG</th>
<th class="tableblock halign-center valign-top">BYTEARRAY[n]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="verse"> COILS</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="verse"> DISCRETE_INPUTS</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="verse"> INPUT_REGISTERS</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="verse"> HOLDING_REGISTERS</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Valid Address Parameters for writing a channel</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Primary Table</th>
<th class="tableblock halign-center valign-top">BOOLEAN</th>
<th class="tableblock halign-center valign-top">SHORT</th>
<th class="tableblock halign-center valign-top">INT</th>
<th class="tableblock halign-center valign-top">FLOAT</th>
<th class="tableblock halign-center valign-top">DOUBLE</th>
<th class="tableblock halign-center valign-top">LONG</th>
<th class="tableblock halign-center valign-top">BYTEARRAY[n]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="verse"> COILS</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="verse"> DISCRETE_INPUTS</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="verse"> INPUT_REGISTERS</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="verse"> HOLDING_REGISTERS</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Examples for valid addresses</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:INPUT_REGISTERS:100:SHORT<span class="tag">&lt;/channelAddress&gt;</span>
<span class="tag">&lt;channelAddress&gt;</span>255:COILS:412:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Examples for invalid addresses</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:INPUT_REGISTERS:100:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span> (BOOLEAN doesn't
go with INPUT_REGISTERS)
<span class="tag">&lt;channelAddress&gt;</span>255:COILS:412:LONG<span class="tag">&lt;/channelAddress&gt;</span> (LONG does not go with COILS)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Function Codes</strong> (more detailed information about how the driver works)</p>
</div>
<div class="paragraph">
<p>The driver is based on the Java Modbus Library (<a href="http://jamod.sourceforge.net">jamod</a>)
which provides read and write access via modbus.
Following table shows which modbus function code is used to access the data of
the channel.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Relation between function code and channel address</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">jamod Method</th>
<th class="tableblock halign-left valign-top">Modbus Function Code</th>
<th class="tableblock halign-left valign-top">Primary Table</th>
<th class="tableblock halign-left valign-top">Access</th>
<th class="tableblock halign-left valign-top">Java Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadCoilsRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 1  Read Coils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadInputDiscretesRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 2  Read Discrete Inputs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discrete Inputs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadMultipleRegistersRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 3  Read Holding Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holding Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short, int, double, long, float, bytearray[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadInputRegistersRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 4  Read Input Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short, int, double, long, float, bytearray[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WriteCoilRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 5  Write Single Coil</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WriteMultipleCoilsRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 15 Write Multiple Coils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WriteMultipleRegistersRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC  6  Write Single Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holding Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short, int, double, long, float, bytearray[]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WriteMultipleRegistersRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC 16  Write Multiple Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holding Registers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short, int, double, long, float, bytearray[]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:INPUT_REGISTERS:100:SHORT<span class="tag">&lt;/channelAddress&gt;</span> will be accessed
via function code 4.</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_modbus_tcp_and_wago">6.2.1. Modbus TCP and Wago</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Till now the driver has been tested with some modules of the Wago 750 Series
with the Fieldbus-Coupler 750-342
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to use the Modbus TCP driver for accessing a Wago device you first
need to know how the process image is build. From the process image you can
derive the register addresses of your Wago modules (AO, AI, DO, DI). You find
detailed information about the process image in
<a href="http://www.wago.com/wagoweb/documentation/750/eng_manu/coupler_controller/m07500342_00000000_0en.pdf">WAGO 750-342 Manual</a>
on page 46 and 47.</p>
</div>
<div class="paragraph">
<p>The following Examples are based on figure <a href="#wago">Wago 750-342 Process Image</a><br></p>
</div>
<div class="paragraph">
<p>*Example 1: Read AI 2 from first (left) 472-module (Register Address 0x0001)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:INPUT_REGISTERS:1:SHORT<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 2: Read DI 3 from first (left) 472-module (Register Address 0x0003)</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:DISCRETE_INPUTS:3:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 3: Write AO 1 from first (left) 550-module (Register Address 0x0000/0x0200)</strong><br></p>
</div>
<div class="paragraph">
<p>For writing only the +0x0200 addresses should be used! Since the driver accepts
only a decimal channelAddress 0x0200 must be converted to decimal. The resulting
address would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:HOLDING_REGISTERS:512:SHORT<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 4: Write DO 2 from 501-module (Register Address 0x0000/0x0201)</strong><br>
For writing only the +0x0200 addresses should be used! Since the driver accepts
only a decimal channelAddress 0x0201 must be converted to decimal. The resulting
address would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:COILS:513:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example 5: Read back DO 2 from 501-module (Register Address 0x0201)</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;channelAddress&gt;</span>255:COILS:513:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span> or
<span class="tag">&lt;channelAddress&gt;</span>255:DISCRETE_INPUTS:513:BOOLEAN<span class="tag">&lt;/channelAddress&gt;</span></code></pre>
</div>
</div>
<div id="wago" class="paragraph">
<div class="title">Wago 750-342 Process Image</div>
<p><span class="image"><a class="image" href="images/modbus_wago_process_image.png"><img src="images/modbus_wago_process_image.png" alt="Driver Modbus Wago process" width="80%"></a></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_m_bus_wired">6.3. M-Bus (wired)</h3>
<div class="paragraph">
<p>M-Bus is communication protocol to read out meters.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">mbus</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;serial_port&gt;:&lt;mbus_address&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[&lt;baudrate&gt;][:timeout]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;dib&gt;:&lt;vib&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>&lt;serial_port&gt; - The serial port should be given that connects to the M-Bus converter.
(e.g. /dev/ttyS0, /dev/ttyUSB0 on Linux).</p>
</div>
<div class="paragraph">
<p>&lt;mbus_address&gt; - The mbus adress can either be the the primary address or secondary
address of the meter. The primary address is specified as integer
(e.g. 1 for primary address 1) whereas the secondary address consits of 8 bytes
that should be specified in hexadecimal form. (e.g. e30456a6b72e3e4e)</p>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p>&lt;baudrate&gt; - If left empty the default is used: "2400"</p>
</div>
<div class="paragraph">
<p>&lt;timeout&gt; - Defines the read timeout in ms. Default is 2500 ms. Example: t5000
for timeout of 5 seconds</p>
</div>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>Shall be of the format &lt;dib&gt;:&lt;vib&gt; in a hexadecimal string format (e.g. 04:03 or 02:fd48)</p>
</div>
</div>
<div class="sect2">
<h3 id="_m_bus_wireless">6.4. M-Bus (wireless)</h3>
<div class="paragraph">
<p>Wireless M-Bus is communication protocol to read out meters and sensors.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">wmbus</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;serial_port&gt;:&lt;secondary_address&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;transceiver&gt; &lt;mode&gt; [&lt;key&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;dib&gt;:&lt;vib&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>&lt;serial_port&gt; - The serial port used for communication. Examples are /dev/ttyS0
(Linux) or COM1 (Windows)</p>
</div>
<div class="paragraph">
<p>&lt;secondary_address&gt; - The secondary address consists of 8 bytes that should be
specified in hexadecimal form. (e.g. e30456a6b72e3e4e)</p>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p>&lt;transceiver&gt; - The transceiver being used. It can be 'amber' or 'rc' for modules
from RadioCrafts.</p>
</div>
<div class="paragraph">
<p>&lt;mode&gt; - The wM-Bus mode can be S or T.</p>
</div>
<div class="paragraph">
<p>&lt;key&gt; - The key in hexadecimal form.</p>
</div>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>Shall be of the format &lt;dib&gt;:&lt;vib&gt; in a hexadecimal string format (e.g. 04:03 or 02:fd48)</p>
</div>
</div>
<div class="sect2">
<h3 id="_iec_60870_5_104">6.5. IEC 60870-5-104</h3>
<div class="paragraph">
<p>IEC 60870-5-104 is an international communication standard for telecontrol.
The IEC 60870-5-104 driver uses the library from the j60870 project.<br>
The driver is able to send general interrogation commands for sampling. For writing
almost all commands are possible.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">iec60870</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[ca=&lt;common_address&gt;] [;p=&lt;port&gt;] [;h=&lt;host_address&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[mft=&lt;message_fragment_timeout&gt;] [;cfl=&lt;cot_field_length&gt;]
[;cafl=&lt;common_address_field_length&gt;] [;ifl=&lt;ioa_field_length&gt;]
 [;mtnar=&lt;max_time_no_ack_received&gt;] [;mtnas=&lt;max_time_no_ack_sent&gt;]
 [;mit=&lt;max_idle_time&gt;] [;mupr=&lt;max_unconfirmed_ipdus_received&gt;]
  [;sct=&lt;stardt_con_timeout&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ca=&lt;common_address&gt;; t=&lt;type_id&gt;; ioa=&lt;ioa&gt;
[;dt=&lt;data_type&gt;] [;i=&lt;index&gt;] [;m=&lt;multiple&gt;]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All options are separated by a semicolon.</p>
</div>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>Mandatory options are <em>Common Address</em>, <em>Type ID</em> and <em>Information Object Address</em>.</p>
</div>
<div class="paragraph">
<p>It is possible to get a single value of a Sequence Information Element, for this
you can define <em>Index</em> of the needed element. The first element is 0, the second 1, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>For reading values which are divided in multiple elements it can be defined how many
elements should be read as one. e.g. <em>i=0;m=4</em> says it reads from the first element
up to the fourth element, of a sequence. This is only allowed for <em>Binary State Information</em>.</p>
</div>
<div class="paragraph">
<p>With the option <em>Data Type</em> it is possible to get a single quality flag.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Data Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">v</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value (default)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in/valid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not topical</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">substituted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blocked</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ov</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">overflow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ei</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">elapsed time invalid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter was adjusted since last reading</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">counter overflow occurred in the</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_iec_61850">6.6. IEC 61850</h3>
<div class="paragraph">
<p>IEC 61850 is an international communication standard used mostly for
substation automation and controlling distributed energy resources
(DER). The IEC 61850 driver uses the client library from the
OpenIEC61850 project.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">iec61850</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;host&gt;[:&lt;port&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-a &lt;authentication parameter&gt;] [-lt &lt;local t-selector&gt;] [-rt &lt;remote t-selector&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;bda reference&gt;:&lt;fc&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>The channel address should be the IEC 61850 Object Reference and the
Functional Constraint of the Basic Data Attribute that is to be
addressed separated by a colon.  Note that an IEC 61850 timestamp received will be
converted to a LongValue that represents the milliseconds since
1970. Some information is lost during this conversion because the IEC
61850 timestamp is more exact.</p>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p>The defaults for TSelLocal and TSelRemote are "00" and "01"
respectively. You can also set either TSelector to the empty string
(e.g. "-lt -rt"). This way they will be omitted in the connection
request.</p>
</div>
</div>
<div class="sect2">
<h3 id="_iec_62056_part_21">6.7. IEC 62056 part 21</h3>
<div class="paragraph">
<p>The IEC 62056 part 21 driver can be used to read out meter via optical interface</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">iec62056p21</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;serial_port&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-d &lt;baud_rate_change_delay&gt;] [-t &lt;timeout&gt;] [-r &lt;number_of_read_retries&gt;]
[-bd &lt;initial_baud_rate&gt;] [-a &lt;device_address&gt;] [-fbd] [-rsc &lt;request_message_start_character&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;data_set_id&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>&lt;serial_port&gt; - The serial port should be given that connects to the M-Bus converter.
(e.g. /dev/ttyS0, /dev/ttyUSB0 on Linux).</p>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p><em>Baud rate change delay</em> <em>-d</em> sets the waiting time in milliseconds between a
baud rate change default is 0.<br>
<em>Timeout</em> <em>-t</em> sets the response timeout in milliseconds, default is 2000.<br>
<em>Number of read retries</em> <em>-r</em>  defines the maximum of read retries, default is 0.<br>
<em>Baud rate</em> <em>-bd</em> sets a initial baud rate e.g. for devices with modem configuration,
default is 300.<br>
<em>Device address</em> <em>-a</em> is mostly needed for devices with RS485, default is no device address.<br>
<em>Fixed baud rate</em> <em>-fbd</em> activates fixed baud rate, default is deactivated.<br>
<em>Request message start character</em> <em>-rsc</em> is used for manufacture specific request
messages. With this option you can change the default start character.<br>
<em>Read standard</em> <em>-rs</em> reads the standard message and the manufacture specific message.
This options has only an affect if the <em>Request message start character</em> is changed.</p>
</div>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>&lt;data_set_id&gt; - Id of the data set. It is usually an OBIS code of the format
A-B:C.D.E*F or on older EDIS code of the format C.D.E.that specifies exactly what
the value of this data set represents.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dlmscosem">6.8. DLMS/COSEM</h3>
<div class="paragraph">
<p>DLMS/COSEM is a international standardized protocol used mostly to communicate
with smart meter devices. The DLMS/COSEM driver uses the client library developed
by the jDLMS project. Currently, the DLMS/COSEM driver supports communication via
HDLC and TCP/IP using Logical Name Referencing to retrieve values from the device.</p>
</div>
<div class="paragraph">
<p><strong>Dependencies:</strong> rxtxcomm_api-2.1.7.jar (optional)</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">dlms</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">t=&lt;serial/tcp&gt; [;h=&lt;inet_address&gt;] [;p=&lt;int&gt;] [;hdlc=&lt;boolean&gt;]<br>
                  [;sp=&lt;sp&gt;] [;bd=&lt;int&gt;] [;d=&lt;d&gt;] [;eh=&lt;eh&gt;] [;iec=&lt;iec&gt;] [;pd=&lt;pd&gt;]<br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[SendDisconnect=&lt;disconnect&gt;];[UseHandshake=&lt;handshake&gt;];[..]
[ld=&lt;int&gt;] [;cid=&lt;cid&gt;] [;sn=&lt;sn&gt;] [;emech=&lt;emech&gt;] [;amech=&lt;amech&gt;]<br>
 [;ekey=&lt;ekey&gt;] [;akey=&lt;akey&gt;] [;pass=&lt;pass&gt;] [;cl=&lt;cl&gt;] [;rt=&lt;rt&gt;] [;mid=&lt;mid&gt;] [;did=&lt;did&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;class-id&gt;/&lt;reference-id&gt;/&lt;attribute-id&gt;[;t=&lt;data_object_type&gt;]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>The interface address consists of all elements the driver needs to uniquely
identify and address a physical smart meter and format depends on the used protocol.
Refer to the following table for the format of the interface address.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Device Address connection type</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top"><em>serial/tcp</em></th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>serial/tcp</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>serial</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial port e.g. sp=ttyS0 or sp=COM1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>serial</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9600</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baud rate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tcp</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host name e.g. h=127.0.0.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">p</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tcp</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4059</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hdlc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>both</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses HDLC if true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>both</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baud rate change delay in milliseconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>flag</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>both</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use initial handshake to negotiate baud rate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>both</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEC 21 address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>both</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Device Address</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Example</div>
<p>Serial with HDLC on serial port ttyUSB0 an 9600 baud:<br>
<em>t=serial;sp=ttyUSB0;bd=9600;hdlc=true</em></p>
</div>
<div class="paragraph">
<p>TCP with HDLC to host 192.168.85.99 on port 5081:<br>
<em>t=tcp;h=192.168.85.99;p=5081;hdlc=true</em></p>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p>Settings are separated by a semi-colon. The available settings are determined by
the used protocol, defined as first parameter of the device address. All possible
settings with a short description and default values are listed in the following
table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Settings</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ld</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical Device Address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use SN referencing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">emech</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption Mechanism</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">amech</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Mechanism</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ekey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>hex_value</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption Key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">akey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>hex_value</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization password to access the smart meter device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Challenge Length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response Timeout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MMM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manufacturer Id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">did</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>long</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Id</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Device Address additional options</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>true</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address in logical name format &lt;Interface_Class_ID&gt;/&lt;Instance_ID&gt;/&lt;Object_Attribute_ID&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>false</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Object Type</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_knx">6.9. KNX</h3>
<div class="paragraph">
<p>KNX is a standardised protocol for intelligent buildings. The KNX
driver uses KNXnet/IP to connect to the wired KNX BUS. The driver
supports group read and writes and is also able to listen to the
BUS. The driver uses the calimero library.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">knx</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">knxip://&lt;host_ip&gt;[:&lt;port&gt;] knxip://&lt;device_ip&gt;[:&lt;port&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[Address=&lt;Individual KNX address (e. g. 2.6.52)&gt;];[SerialNumber=&lt;Serial number&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;Group Adress&gt;:&lt;DPT_ID&gt;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>The device address consists of the host IP and the IP of the KNX tunnel or router.</p>
</div>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>The channel address consist of the group address you want to monitor and the
corresponding data point ID. A data point consists of a main number and a subtype.
For example a boolean would be represented by the main number 1 and a switch by
the subtype 001, the DPT_ID of a switch is 1.001.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ehz">6.10. eHZ</h3>
<div class="paragraph">
<p>OpenMUC driver for SML and IEC 62056-21</p>
</div>
<div class="paragraph">
<p><strong>Dependencies:</strong> rxtxcomm_api-2.1.7.jar</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">ehz</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sml://&lt;serialPort&gt; or iec://&lt;serialPort&gt;  e.g. sml:///dev/ttyUSB0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;OBIScode&gt; e.g. 10181ff (not 1-0:1.8.1*255)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>scanForDevices() and scanForChannels will return the specific configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_snmp">6.11. SNMP</h3>
<div class="paragraph">
<p>Simple Network Management Protocol (SNMP) is an Internet-standard protocol for
monitoring and management of devices on IP networks.</p>
</div>
<div class="paragraph">
<p><strong>Dependencies:</strong> snmp4j-2.2.5.jar</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">snmp</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP/snmpPort</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP OID address</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Device Address</strong></p>
</div>
<div class="paragraph">
<p>IP address and available SNMP port of the target device should be provided as Device Address.</p>
</div>
<div class="paragraph">
<p><strong>Example for Device Address:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>192.168.1.1/161</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="paragraph">
<p>All settings are stored in "SnmpDriverSettingVariableNames" enum.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Setting Parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SNMPVersion</th>
<th class="tableblock halign-left valign-top">"SNMPVersion" enum contains all available values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">USERNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SECURITYNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AUTHENTICATIONPASSPHRASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is the same COMMUNITY word in SNMP V2c</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRIVACYPASSPHRASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>SNMPVersion</strong></p>
</div>
<div class="paragraph">
<p>SNMPVersion is an enum variable containing valid SNMP versions. (V1, V2c, V3)</p>
</div>
<div class="paragraph">
<p><strong>Example for valid settings string:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>SNMPVersion=V2c:USERNAME=public:SECURITYNAME=public:AUTHENTICATIONPASSPHRASE=password</pre>
</div>
</div>
<div class="paragraph">
<p>In order to read specific channel, corresponding SNMP OID shall be passed.</p>
</div>
<div class="paragraph">
<p><strong>Example for SNMP OID:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>1.3.6.1.2.1.1.1.0</pre>
</div>
</div>
<div class="paragraph">
<p>For scanning SNMP enabled devices in the network, range of IP addresses shall be
provided. This functionality is implemented only for SNMP V2c.</p>
</div>
</div>
<div class="sect2">
<h3 id="_csv">6.12. CSV</h3>
<div class="paragraph">
<p>The csv driver supports sampling from a csv file. This feature can be very helpful during application development or show cases, when no real hardware is available. For example, our SimpleDemoApp uses data provided by the csv driver.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">csv</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path to csv file (e.g. /path/to/my.csv)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">samplingmode=&lt;samplingmode&gt;[;rewind=&lt;rewind&gt;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">column name</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Settings</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Samplingmode</strong> configures how the csv file is sampled. Currently, three different modes are supported:</p>
<div class="ulist">
<ul>
<li>
<p>line - starts sampling from the first line of the csv file. Timestamps are ignored and each sampling reads the next line.</p>
</li>
<li>
<p>unixtimestamp - csv file must contain a column with the name <em>unixtimestamp</em>, values must be in milliseconds. During sampling the driver searches the closest unixtimestamp which is &gt;= the sampling timestamp. Therefore, the driver keeps returning the same value for sampling timestamps which are before the next unixtimestamp of the csv file.</p>
</li>
<li>
<p>hhmmss - csv file must contain a column with the name <em>hhmmss</em> and the time values must be in the format: hhmmss.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>rewind</strong> - If <em>true</em> and the last line of the csv file is reached, then the driver will start sampling again from first line. This option can only be used in combination with sampling mode <em>hhmmss</em> or <em>line</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The columns <em>unixtimestamp</em> and <em>hhmmss</em> are part of the log files created by the AsciiLogger, therefore the csv driver supports these files.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration for csv driver</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smarthome</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;description</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;deviceAddress&gt;</span>./csv-driver/smarthome.csv<span class="tag">&lt;/deviceAddress&gt;</span>
  <span class="tag">&lt;settings&gt;</span>samplingmode=hhmmss;rewind=true<span class="tag">&lt;/settings&gt;</span>
  <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">power_pv</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;channelAddress&gt;</span>power_photovoltaics<span class="tag">&lt;/channelAddress&gt;</span>
    <span class="tag">&lt;unit&gt;</span>W<span class="tag">&lt;/unit&gt;</span>
    <span class="tag">&lt;samplingInterval&gt;</span>5s<span class="tag">&lt;/samplingInterval&gt;</span>
    <span class="tag">&lt;loggingInterval&gt;</span>5s<span class="tag">&lt;/loggingInterval&gt;</span>
<span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aggregator">6.13. Aggregator</h3>
<div class="paragraph">
<p>The Aggregator which performs aggregation of logged values from a channel. It
uses the DriverService and the DataAccessService. It is therefore a kind of
OpenMUC driver/application mix. The aggregator is fully configurable through the
channels.xml config file.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">aggregator</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">virtual device e.g "aggregatordevice"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;sourceChannelId&gt;:&lt;aggregationType&gt;[:&lt;quality&gt;]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Channel Address</strong></p>
</div>
<div class="paragraph">
<p>&lt;sourceChannelId&gt; - id of channel to be aggregated</p>
</div>
<div class="paragraph">
<p>&lt;aggregationType&gt; -</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AVG: calculates the average of all values of interval (e.g. for average power)</p>
</li>
<li>
<p>LAST: takes the last value of interval (e.g. for energy)</p>
</li>
<li>
<p>DIFF: calculates difference of first and last value of interval</p>
</li>
<li>
<p>PULS_ENERGY,&lt;pulses per Wh&gt;,&lt;max counter&gt;: calculates energy from pulses of
interval (e.g. for pulse counter/meter). Example: PULSE_ENERGY,10,65535</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&lt;quality&gt; - Range 0.0 - 1.0. Percentage of the expected valid/available logged
records for aggregation. Default value is 1.0. Example: Aggregation of 5s values
to 15min. The 15min interval consists of 180 5s values. If quality is 0.9 then at
least 162 of 180 values must be valid/available for aggregation.
NOTE: The missing/invalid values could appear as block at the beginning or end
of the interval, which might be problematic for some aggregation types</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>Channel A (channelA) is sampled and logged every 10 seconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;channelid</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">channelA</span><span class="error">&quot;</span><span class="tag">&gt;</span>
   <span class="tag">&lt;samplingInterval&gt;</span>10s<span class="tag">&lt;/samplingInterval&gt;</span>
   <span class="tag">&lt;loggingInterval&gt;</span>10s<span class="tag">&lt;/loggingInterval&gt;</span>
 <span class="tag">&lt;/channel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you want a channel B (channelB) which contains the same values as channel A
but in a 1 minute resolution by using the 'average' as aggregation type. You can
achieve this by simply adding the aggregator driver to your channel config file
and define a the channel B as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aggregator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aggregatordevice</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
     <span class="tag">&lt;channelid</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">channelB</span><span class="error">&quot;</span><span class="tag">&gt;</span>
       <span class="tag">&lt;channelAddress&gt;</span>channelA:avg<span class="tag">&lt;/channelAddress&gt;</span>
       <span class="tag">&lt;samplingInterval&gt;</span>60s<span class="tag">&lt;/samplingInterval&gt;</span>
       <span class="tag">&lt;loggingInterval&gt;</span>60s<span class="tag">&lt;/loggingInterval&gt;</span>
     <span class="tag">&lt;/channel&gt;</span>
   <span class="tag">&lt;/device&gt;</span>
 <span class="tag">&lt;/driver&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The new (aggregated) channel has the id channelB. The channel address consists of
the channel id of the original channel and the aggregation type which is channelA:avg
in this example. OpenMUC calls the read method of the aggregator every minute. The
aggregator then gets all logged records from channelA of the last minute, calculates
the average and sets this value for the record of channelB.
NOTE: It&#8217;s recommended to specify the samplingTimeOffset for channelB. It should
be between samplingIntervalB - samplingIntervalA and samplingIntervalB. In this
example: 50 &lt; offset &lt; 60. This constraint ensures that values are AGGREGATED
CORRECTLY. At hh:mm:55 the aggregator gets the logged values of channelA and at
hh:mm:60 respectively hh:mm:00 the aggregated value is logged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aggregator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aggregatordevice</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
     <span class="tag">&lt;channelid</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">channelB</span><span class="error">&quot;</span><span class="tag">&gt;</span>
       <span class="tag">&lt;channelAddress&gt;</span>channelA:avg<span class="tag">&lt;/channelAddress&gt;</span>
       <span class="tag">&lt;samplingInterval&gt;</span>60s<span class="tag">&lt;/samplingInterval&gt;</span>
       <span class="tag">&lt;samplingTimeOffset&gt;</span>55s<span class="tag">&lt;/samplingTimeOffset&gt;</span>
       <span class="tag">&lt;loggingInterval&gt;</span>60s<span class="tag">&lt;/loggingInterval&gt;</span>
     <span class="tag">&lt;/channel&gt;</span>
   <span class="tag">&lt;/device&gt;</span>
 <span class="tag">&lt;/driver&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_restjson">6.14. REST/JSON</h3>
<div class="paragraph">
<p>Driver to connect an OpenMUC instance with an remote OpenMUC instance with REST.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Configuration Synopsis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">rest</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http(s)://&lt;address&gt;:&lt;port&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[ct;]&lt;username&gt;:&lt;password&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;channelID&gt;</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>host_address: the address of the remote OpenMUC eg. 127.0.0.1</p>
</li>
<li>
<p>port: the port of the remote OpenMUC eg. 8888</p>
</li>
<li>
<p>ct: this optional flag defines if the driver should check the remote timestamp, before reading the complete record</p>
</li>
<li>
<p>username: the username of the remote OpenMUC</p>
</li>
<li>
<p>password: the pasword of the remote OpenMUC</p>
</li>
<li>
<p>channelID: the ID of the remote OpenMUC</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Supported features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>read channel</p>
</li>
<li>
<p>write channel</p>
</li>
<li>
<p>scan for all channels</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Not supported features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>scan for devices</p>
</li>
<li>
<p>reading whole devices instead of single channel</p>
</li>
<li>
<p>listening</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>Connecting to an remote OpenMUC instance (192.168.8.18:8888) and reading the channel "power_grid"
every 5s if the timestamp has changed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example_rest_device</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;deviceAddress&gt;</span>http://192.168.8.18:8888<span class="tag">&lt;/deviceAddress&gt;</span>
      <span class="tag">&lt;settings&gt;</span>ct;admin:admin<span class="tag">&lt;/settings&gt;</span>
      <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">power_grid_rest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;channelAddress&gt;</span>power_grid<span class="tag">&lt;/channelAddress&gt;</span>
        <span class="tag">&lt;samplingInterval&gt;</span>5s<span class="tag">&lt;/samplingInterval&gt;</span>
      <span class="tag">&lt;/channel&gt;</span>
   <span class="tag">&lt;/device&gt;</span>
<span class="tag">&lt;/driver&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="anchor-web-ui">7. The WebUI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_plugins">7.1. Plugins</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Plotter</dt>
<dd>
<p>Plugin which provides plotter for visualisation of current and historical data</p>
</dd>
<dt class="hdlist1">Channel Access Tool</dt>
<dd>
<p>Plugin to show current values of selected channels. Provides possibility to set values.</p>
</dd>
<dt class="hdlist1">Channel Configurator</dt>
<dd>
<p>Plugin for channel configuration e.g. channel name, sampling interval, logging interval</p>
</dd>
<dt class="hdlist1">Media Viewer</dt>
<dd>
<p>Plugin which allows to embed media files into OpenMUC&#8217;s WebUI</p>
</dd>
<dt class="hdlist1">User Configurator</dt>
<dd>
<p>Plugin for user configuration</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_context_root">7.2. Context Root</h3>
<div class="paragraph">
<p>The servlet context root of the OpenMUC WebUI can be configured, by setting the <code>org.apache.felix.http.context_path</code>
system property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>org.apache.felix.http.context_path=/muc1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This must be a valid path starting with a slash and not ending with a slash (unless it is the root context).</p>
</div>
</div>
<div class="sect2">
<h3 id="_https">7.3. HTTPS</h3>
<div class="paragraph">
<p>You can access the WebUI over https as well:
<a href="https://localhost:8889" class="bare">https://localhost:8889</a>. To make the framework more secure you could
disable http by setting org.apache.felix.http.enable in the
conf/system.properties file to false.</p>
</div>
</div>
<div class="sect2">
<h3 id="_custom_plugins">7.4. Custom Plugins</h3>
<div class="paragraph">
<p>You can include your own Plugins in the OpenMUC WebUI by creating a java class that extends the WebUiPluginService. This class also has to be annotated as a component. The two functions getAlias and getName have to be overridden. The alias is used to identify the plugin while the name will be displayed in the WebUI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>(service = WebUiPluginService.class)
<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">SamplePlugin</span> <span class="directive">extends</span> WebUiPluginService {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getAlias() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">sampleplugin</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Sample Plugin</span><span class="delimiter">&quot;</span></span>;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to display an icon above the plugins name, the file needs to be called icon and saved under <code>samplePlugin/src/main/resources/images</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_visualisation">7.5. Visualisation</h3>
<div class="paragraph">
<p>First you need a svg and assign all the svg Elements a unique id. You can include an external svg as an Object Element or you can create the svg directly in html. Either way the Element containing the svg needs an id which you can then use to access the svg in javascript.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">svg_document = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">samplePluginGraphic</span><span class="delimiter">'</span></span>).contentDocument;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can manipulate the Elements of the svg, the easiest way to do this is through getElementById for a single Element or getElementsByClass for multiple Elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">sampleText = svg_document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">sampleTextField</span><span class="delimiter">&quot;</span></span>);
sampleText.textContent = channel.record.value;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aside from changing what is displayed you can also manipulate the css in this way. The following example would change the displayed texts color to blue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">sampleText.style.fill = <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="id_restful_web_services">8. REST Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The openmuc-server-restws bundle manages a RESTful web service to access all
registered channels of the framework. The RESTful web service is accessed by the
same port as the web interface mentioned in Chapter 2.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The address to access the web service using the provided demo/framework folder is 'http://localhost:8888/rest/'
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_requirements">8.1. Requirements</h3>
<div class="paragraph">
<p>In order to start the RESTful web service, the following bundle must be provided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bundle that provides an org.osgi.service.http.HttpService service. In the demo framework, that service is provided by the org.apache.felix.http.jetty bundle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This bundles is already provided by the demo framework. The RESTful web service
will start automatically with the framework without additional settings.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_channels">8.2. Accessing channels</h3>
<div class="paragraph">
<p>The latest record of a single channel can be accessed, by sending a
GET request at the address:
'http://server-address/rest/channels/{id}' where {id} is replaced
with the actual channel ID. The result will be latest record object of
the channel encoded in JSON with the following structure:</p>
</div>
<div class="listingblock">
<div class="title">Record JSON</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">timestamp</span><span class="delimiter">&quot;</span></span> : <span class="error">t</span><span class="error">i</span><span class="error">m</span><span class="error">e</span><span class="error">_</span><span class="error">v</span><span class="error">a</span><span class="error">l</span>, <span class="error">/</span><span class="error">*</span><span class="error">m</span><span class="error">i</span><span class="error">l</span><span class="error">l</span><span class="error">i</span><span class="error">s</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">n</span><span class="error">d</span><span class="error">s</span> <span class="error">s</span><span class="error">i</span><span class="error">n</span><span class="error">c</span><span class="error">e</span> <span class="error">U</span><span class="error">n</span><span class="error">i</span><span class="error">x</span> <span class="error">e</span><span class="error">p</span><span class="error">o</span><span class="error">c</span><span class="error">h</span><span class="error">*</span><span class="error">/</span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">flag</span><span class="delimiter">&quot;</span></span> : <span class="error">f</span><span class="error">l</span><span class="error">a</span><span class="error">g</span><span class="error">_</span><span class="error">v</span><span class="error">a</span><span class="error">l</span>,      <span class="error">/</span><span class="error">*</span><span class="error">s</span><span class="error">t</span><span class="error">a</span><span class="error">t</span><span class="error">u</span><span class="error">s</span> <span class="error">f</span><span class="error">l</span><span class="error">a</span><span class="error">g</span> <span class="error">o</span><span class="error">f</span> <span class="error">t</span><span class="error">h</span><span class="error">e</span> <span class="error">r</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">r</span><span class="error">d</span> <span class="error">a</span><span class="error">s</span> <span class="error">s</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">n</span><span class="error">g</span><span class="error">*</span><span class="error">/</span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span> : <span class="error">v</span><span class="error">a</span><span class="error">l</span><span class="error">u</span><span class="error">e</span><span class="error">_</span><span class="error">v</span><span class="error">a</span><span class="error">l</span>     <span class="error">/</span><span class="error">*</span><span class="error">a</span><span class="error">c</span><span class="error">t</span><span class="error">u</span><span class="error">a</span><span class="error">l</span> <span class="error">v</span><span class="error">a</span><span class="error">l</span><span class="error">u</span><span class="error">e</span><span class="error">.</span> <span class="error">O</span><span class="error">m</span><span class="error">i</span><span class="error">t</span><span class="error">t</span><span class="error">e</span><span class="error">d</span> <span class="error">i</span><span class="error">f</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">flag</span><span class="delimiter">&quot;</span></span> <span class="error">!</span><span class="error">=</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">valid</span><span class="delimiter">&quot;</span></span><span class="error">*</span><span class="error">/</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access logged values of a channel by adding
'/history?from=fromTimestamp&amp;until=untilTimestamp' to the channel
address, fromTimestamp and untilTimestamp are both milliseconds since
Unix epoch (1970-01-01 00:00:00). The result is a collection of
records encoded as JSON.</p>
</div>
<div class="paragraph">
<p>Additionally, the records off all available channels can be read in one
go, by omitting the ID from the address. The result is a collection of
channel objects encoded in JSON using this structure:</p>
</div>
<div class="listingblock">
<div class="title">ChannelCollection JSON</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
        {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> : <span class="error">c</span><span class="error">h</span><span class="error">a</span><span class="error">n</span><span class="error">n</span><span class="error">e</span><span class="error">l</span><span class="integer">1</span><span class="error">_</span><span class="error">i</span><span class="error">d</span>,  <span class="error">/</span><span class="error">*</span><span class="error">I</span><span class="error">D</span> <span class="error">o</span><span class="error">f</span> <span class="error">t</span><span class="error">h</span><span class="error">e</span> <span class="error">c</span><span class="error">h</span><span class="error">a</span><span class="error">n</span><span class="error">n</span><span class="error">e</span><span class="error">l</span> <span class="error">a</span><span class="error">s</span> <span class="error">s</span><span class="error">t</span><span class="error">r</span><span class="error">i</span><span class="error">n</span><span class="error">g</span><span class="error">*</span><span class="error">/</span>
                <span class="key"><span class="delimiter">&quot;</span><span class="content">record</span><span class="delimiter">&quot;</span></span> : <span class="error">c</span><span class="error">h</span><span class="error">a</span><span class="error">n</span><span class="error">n</span><span class="error">e</span><span class="error">l</span><span class="integer">1</span><span class="error">_</span><span class="error">r</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">r</span><span class="error">d</span> <span class="error">/</span><span class="error">*</span><span class="error">c</span><span class="error">u</span><span class="error">r</span><span class="error">r</span><span class="error">e</span><span class="error">n</span><span class="error">t</span> <span class="error">r</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">r</span><span class="error">d</span><span class="error">.</span> <span class="error">s</span><span class="error">e</span><span class="error">e</span> <span class="error">R</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">r</span><span class="error">d</span> <span class="error">J</span><span class="error">S</span><span class="error">O</span><span class="error">N</span><span class="error">*</span><span class="error">/</span>
        },
        {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> : <span class="error">c</span><span class="error">h</span><span class="error">a</span><span class="error">n</span><span class="error">n</span><span class="error">e</span><span class="error">l</span><span class="integer">2</span><span class="error">_</span><span class="error">i</span><span class="error">d</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">record</span><span class="delimiter">&quot;</span></span> : <span class="error">c</span><span class="error">h</span><span class="error">a</span><span class="error">n</span><span class="error">n</span><span class="error">e</span><span class="error">l</span><span class="integer">2</span><span class="error">_</span><span class="error">r</span><span class="error">e</span><span class="error">c</span><span class="error">o</span><span class="error">r</span><span class="error">d</span>
        }
        <span class="error">.</span><span class="error">.</span><span class="error">.</span>
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>New records can be written to channels by sending a PUT request at the
address that represents a channel. The data in the put request is a
record encoded as specified in Record JSON above.</p>
</div>
<div class="paragraph">
<p>If HTTPS is used to access the REST server then HTTP basic
authentication is required. The login credentials are the same as the
one used to log into the web interface of the OpenMUC Framework.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="id_modbus_service">9. Modbus Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The modus service allows you to access to a OpenMUC channel by ModbusTCP protocol.
For accessing a channel through Modbus the channel has to be mapped with
<em>serverMapping</em> and the Modbus Server bundle has to copied in the bundle folder.</p>
</div>
<div class="paragraph">
<p>ServerMapping ID: <em>modbus</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. serverMapping</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Primary Table</th>
<th class="tableblock halign-center valign-top">BOOLEAN</th>
<th class="tableblock halign-center valign-top">SHORT</th>
<th class="tableblock halign-center valign-top">INT</th>
<th class="tableblock halign-center valign-top">FLOAT</th>
<th class="tableblock halign-center valign-top">DOUBLE</th>
<th class="tableblock halign-center valign-top">LONG</th>
<th class="tableblock halign-center valign-top">BYTEARRAY[n]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INPUT_REGISTER</p></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HOLDING_REGISTERS</p></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> x</div></td>
<td class="tableblock halign-center valign-top"><div class="verse"> -</div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>DISCRETE_INPUTS and COIL are not supported yet.</p>
</div>
<div class="paragraph">
<div class="title">Server Settings</div>
<p>Server settings are done in the <em>system.properties</em>.</p>
</div>
<div class="paragraph">
<p>If you run ModbusTCP Server without root-privileges you have to allow Felix to
bind Port 502 with setcap.</p>
</div>
<div class="listingblock">
<div class="title">Console e.g. bash</div>
<div class="content">
<pre>setcap 'cap_net_bind_service=+ep' /path/to/program</pre>
</div>
</div>
<div class="sect2">
<h3 id="_example">9.1. Example</h3>
<div class="listingblock">
<div class="title">channels.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>
<span class="tag">&lt;configuration&gt;</span>

  <span class="tag">&lt;driver</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">virtual</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;device</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sample_device</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sample_channel_1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;serverMapping</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">modbus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>HOLDING_REGISTERS:1000:INTEGER<span class="tag">&lt;/serverMapping&gt;</span>
        <span class="tag">&lt;valueType&gt;</span>INTEGER<span class="tag">&lt;/valueType&gt;</span>
      <span class="tag">&lt;/channel&gt;</span>

      <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sample_channel_2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;serverMapping</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">modbus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>HOLDING_REGISTERS:1002:BOOLEAN<span class="tag">&lt;/serverMapping&gt;</span>
        <span class="tag">&lt;valueType&gt;</span>BOOLEAN<span class="tag">&lt;/valueType&gt;</span>
      <span class="tag">&lt;/channel&gt;</span>

      <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sample_channel_3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;serverMapping</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">modbus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>INPUT_REGISTERS:1000:DOUBLE<span class="tag">&lt;/serverMapping&gt;</span>
      <span class="tag">&lt;/channel&gt;</span>

      <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sample_channel_4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;serverMapping</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">modbus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>INPUT_REGISTERS:1004:LONG<span class="tag">&lt;/serverMapping&gt;</span>
        <span class="tag">&lt;valueType&gt;</span>LONG<span class="tag">&lt;/valueType&gt;</span>
      <span class="tag">&lt;/channel&gt;</span>

    <span class="tag">&lt;/device&gt;</span>
  <span class="tag">&lt;/driver&gt;</span>

<span class="tag">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">system.properties</div>
<div class="content">
<pre>org.openmuc.framework.server.modbus.address=127.0.0.1
org.openmuc.framework.server.modbus.port=5502
org.openmuc.framework.server.modbus.unitId=1
org.openmuc.framework.server.modbus.master=false</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authors">10. Authors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Developers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dirk Zimmermann</p>
</li>
<li>
<p>Marco Mittelsdorf</p>
</li>
<li>
<p>Chris Dieter Medam</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Former developers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Stefan Feuerhahn</p>
</li>
<li>
<p>Albrecht Schall</p>
</li>
<li>
<p>Michael Zillgith</p>
</li>
<li>
<p>Karsten Müller-Bier</p>
</li>
<li>
<p>Simon Fey</p>
</li>
<li>
<p>Frederic Robra</p>
</li>
<li>
<p>Philipp Fels</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-12-20 16:36:57 +0100
</div>
</div>
</body>
</html>